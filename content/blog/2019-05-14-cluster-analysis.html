---
title: Cluster Analysis
author: Brett R. Taylor
date: '2019-05-14'
slug: cluster-analysis
categories:
  - Data
  - Statistics
  - Science
tags:
  - Data
  - R
banner: "img/cluster_analysis.png"

---



<div id="basics" class="section level1">
<h1>Basics</h1>
<p>Tidyverse is a set of R libraries that enables the best methods for Data Management. I will use the tidyverse libraries to perform cluster analysis and provide this information to other data science teams in the industry.</p>
<pre class="r"><code>library(devtools)
install_github(&quot;kassambara/factoextra&quot;)</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.0       ✔ purrr   0.3.2  
## ✔ tibble  2.1.1       ✔ dplyr   0.8.0.1
## ✔ tidyr   0.8.3       ✔ stringr 1.4.0  
## ✔ readr   1.3.1       ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div id="introduction-to-r" class="section level2">
<h2>Introduction to R</h2>
</div>
<div id="data-preparation-and-r-packages" class="section level2">
<h2>Data Preparation and R Packages</h2>
<div id="required-packages" class="section level3">
<h3>Required Packages</h3>
<ul>
<li>dplyr</li>
<li>tidyr</li>
<li>testthat</li>
<li>cluster</li>
<li>factoextra</li>
</ul>
</div>
<div id="data-standardization" class="section level3">
<h3>Data Standardization</h3>
<p>We need the ability to transform vectors in our data frames to standard variables. A standard variable is the 0 +|- 1 std. In other words, the variables need to be similar so that clustering algorithms can accurately determine the distance between each variable used in the algorithm. The solution is to standardize the variables using the scale() function.</p>
<div id="how-to-apply-data-standardization-with-tidyverse" class="section level4">
<h4>How to apply Data Standardization with tidyverse</h4>
<p>Tidyverse has evolved over the last year and a half significantly since version 0.7 was released. A new way to mutate columns in a data.frame is to use the function mutate_at(). This function allows you to programatically create a solution to transform specific columns into a different format.</p>
<pre class="r"><code>library(dplyr)

set.seed(1234)
dat &lt;- data.frame(x = rnorm(20, 30, .2), 
                  y = runif(20, 3, 5),
                  z = runif(20, 10, 20))
dat</code></pre>
<pre><code>##           x        y        z
## 1  29.75859 4.106667 18.64834
## 2  30.05549 4.292812 10.41857
## 3  30.21689 3.623649 13.17182
## 4  29.53086 4.243638 10.13750
## 5  30.08582 3.659540 12.39026
## 6  30.10121 4.003995 17.06495
## 7  29.88505 4.354189 13.08095
## 8  29.89067 3.969982 15.08548
## 9  29.88711 3.487858 10.51647
## 10 29.82199 4.530920 15.64570
## 11 29.90456 3.147560 11.21480
## 12 29.80032 3.619373 18.92836
## 13 29.84475 4.434543 10.14627
## 14 30.01289 4.009092 17.83121
## 15 30.19190 3.305998 10.89961
## 16 29.97794 4.007867 15.19190
## 17 29.89780 3.987922 13.84267
## 18 29.81776 4.502400 10.70052
## 19 29.83257 3.349300 13.20644
## 20 30.48317 4.696785 16.68495</code></pre>
<pre class="r"><code>dat2 &lt;- dat %&gt;% mutate_at(.vars = vars(c(&quot;y&quot;,&quot;z&quot;)),.funs = funs(scale(.) %&gt;% as.vector))
dat2</code></pre>
<pre><code>##           x            y           z
## 1  29.75859  0.314375410  1.64613940
## 2  30.05549  0.732482714 -1.11411786
## 3  30.21689 -0.770550770 -0.19068026
## 4  29.53086  0.622031610 -1.20838966
## 5  30.08582 -0.689932988 -0.45281634
## 6  30.10121  0.083759438  1.11507085
## 7  29.88505  0.870343603 -0.22115932
## 8  29.89067  0.007362755  0.45115791
## 9  29.88711 -1.075555954 -1.08128447
## 10 29.82199  1.267304676  0.63905620
## 11 29.90456 -1.839911861 -0.84706320
## 12 29.80032 -0.780153930  1.74005974
## 13 29.84475  1.050830717 -1.20544714
## 14 30.01289  0.095207728  1.37207551
## 15 30.19190 -1.484037952 -0.95277721
## 16 29.97794  0.092456551  0.48685249
## 17 29.89780  0.047657044  0.03432076
## 18 29.81776  1.203246670 -1.01955129
## 19 29.83257 -1.386776307 -0.17906784
## 20 30.48317  1.639860846  0.98762174</code></pre>
</div>
</div>
</div>
<div id="clustering-distance-measures" class="section level2">
<h2>Clustering Distance Measures</h2>
<div id="distance-matrix-computation" class="section level3">
<h3>Distance Matrix Computation</h3>
<pre class="r"><code>data(&quot;USArrests&quot;)
str(USArrests)</code></pre>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  4 variables:
##  $ Murder  : num  13.2 10 8.1 8.8 9 7.9 3.3 5.9 15.4 17.4 ...
##  $ Assault : int  236 263 294 190 276 204 110 238 335 211 ...
##  $ UrbanPop: int  58 48 80 50 91 78 77 72 80 60 ...
##  $ Rape    : num  21.2 44.5 31 19.5 40.6 38.7 11.1 15.8 31.9 25.8 ...</code></pre>
<pre class="r"><code>set.seed(123)
data(&quot;USArrests&quot;)
df &lt;- USArrests%&gt;%sample_n(15)
 
df_scaled &lt;- df%&gt;%mutate_all(.funs =funs(scale(.) %&gt;% as.vector) )
row.names(df_scaled) &lt;- row.names(df)
df_scaled</code></pre>
<pre><code>##         Murder     Assault    UrbanPop        Rape
## 1  -1.25084081 -1.49648631 -0.62700287 -1.07250811
## 2  -1.00795910 -0.06238736  1.68571262 -1.43321712
## 3   0.59101216  1.46893865  0.14390230  0.91139142
## 4   0.97557487  0.10775998 -0.47282183  0.80317872
## 5  -1.04843939 -0.71866993  1.14607901  0.32223338
## 6  -0.05667240  1.39601836  1.14607901  1.29614769
## 7   1.56253901  0.97065003 -1.62917958 -0.37513737
## 8  -1.16988024 -1.53294646  0.06681178 -1.13262628
## 9   0.02428817 -0.28114821 -0.16445977  0.05771344
## 10 -1.27108096 -1.16834503 -1.08954596 -1.49333528
## 11  0.87437416  0.26575393  1.14607901  0.63484785
## 12  1.42085801  0.84911622  0.06681178  0.23806794
## 13 -0.48171539 -0.85235712 -0.93536493 -0.45930280
## 14  0.75293331  0.92203650  0.68353591  1.78911667
## 15  0.08500860  0.13206674 -1.16663648 -0.08657016</code></pre>
</div>
<div id="calculate-euclidean-distance" class="section level3">
<h3>Calculate Euclidean Distance</h3>
<pre class="r"><code>dist_eucl &lt;- dist(df_scaled,method = &quot;euclidean&quot;)
dist_eucl</code></pre>
<pre><code>##            1         2         3         4         5         6         7
## 2  2.7557930                                                            
## 3  4.0885596 3.5743582                                                  
## 4  3.3275375 3.6910831 1.5468531                                        
## 5  2.3948043 1.9506810 2.9706730 2.7625656                              
## 6  4.3066195 3.2821533 1.2558695 2.3641071 2.5306160                    
## 7  3.9360579 4.4477713 2.4476788 1.9531252 4.2260379 3.6466475          
## 8  0.7020519 2.2135847 4.0368314 3.3665176 1.9897810 4.1087501 4.1453934
## 9  2.1434429 2.5998851 2.0513004 1.3065227 1.7690823 2.4638737 2.5031936
## 10 0.7064899 2.9996750 4.2103160 3.5114430 2.9233689 4.5639875 3.7611531
## 11 3.6987718 2.8668715 1.6151724 1.6384074 2.1826658 1.6067554 3.1132908
## 12 3.8521181 3.4848278 1.2377930 1.1655217 3.1188595 2.1832427 1.8130779
## 13 1.2155510 2.9528869 3.0956064 2.2030264 2.2983159 3.5566655 2.8267992
## 14 4.4464336 3.9316187 1.1776784 1.7383476 2.8814153 1.1563238 3.2696289
## 15 2.3874582 3.3439115 2.1809872 1.4376129 2.7430331 2.9796323 1.7842464
##            8         9        10        11        12        13        14
## 2                                                                       
## 3                                                                       
## 4                                                                       
## 5                                                                       
## 6                                                                       
## 7                                                                       
## 8                                                                       
## 9  2.1126837                                                            
## 10 1.2690351 2.3930391                                                  
## 11 3.4209767 1.7528104 4.0232822                                        
## 12 3.7768969 1.8204173 3.9562110 1.4004314                              
## 13 1.5474157 1.2016321 1.3475687 2.9357666 2.8293959                    
## 14 4.3175321 2.3865102 4.7312407 1.4112892 1.7993170 3.5141230          
## 15 2.6386820 1.0952669 2.3483996 2.5514833 1.9812718 1.2176545 2.8304619</code></pre>
<p>Reformat as Matrix</p>
<pre class="r"><code>round(as.matrix(dist_eucl),1)</code></pre>
<pre><code>##      1   2   3   4   5   6   7   8   9  10  11  12  13  14  15
## 1  0.0 2.8 4.1 3.3 2.4 4.3 3.9 0.7 2.1 0.7 3.7 3.9 1.2 4.4 2.4
## 2  2.8 0.0 3.6 3.7 2.0 3.3 4.4 2.2 2.6 3.0 2.9 3.5 3.0 3.9 3.3
## 3  4.1 3.6 0.0 1.5 3.0 1.3 2.4 4.0 2.1 4.2 1.6 1.2 3.1 1.2 2.2
## 4  3.3 3.7 1.5 0.0 2.8 2.4 2.0 3.4 1.3 3.5 1.6 1.2 2.2 1.7 1.4
## 5  2.4 2.0 3.0 2.8 0.0 2.5 4.2 2.0 1.8 2.9 2.2 3.1 2.3 2.9 2.7
## 6  4.3 3.3 1.3 2.4 2.5 0.0 3.6 4.1 2.5 4.6 1.6 2.2 3.6 1.2 3.0
## 7  3.9 4.4 2.4 2.0 4.2 3.6 0.0 4.1 2.5 3.8 3.1 1.8 2.8 3.3 1.8
## 8  0.7 2.2 4.0 3.4 2.0 4.1 4.1 0.0 2.1 1.3 3.4 3.8 1.5 4.3 2.6
## 9  2.1 2.6 2.1 1.3 1.8 2.5 2.5 2.1 0.0 2.4 1.8 1.8 1.2 2.4 1.1
## 10 0.7 3.0 4.2 3.5 2.9 4.6 3.8 1.3 2.4 0.0 4.0 4.0 1.3 4.7 2.3
## 11 3.7 2.9 1.6 1.6 2.2 1.6 3.1 3.4 1.8 4.0 0.0 1.4 2.9 1.4 2.6
## 12 3.9 3.5 1.2 1.2 3.1 2.2 1.8 3.8 1.8 4.0 1.4 0.0 2.8 1.8 2.0
## 13 1.2 3.0 3.1 2.2 2.3 3.6 2.8 1.5 1.2 1.3 2.9 2.8 0.0 3.5 1.2
## 14 4.4 3.9 1.2 1.7 2.9 1.2 3.3 4.3 2.4 4.7 1.4 1.8 3.5 0.0 2.8
## 15 2.4 3.3 2.2 1.4 2.7 3.0 1.8 2.6 1.1 2.3 2.6 2.0 1.2 2.8 0.0</code></pre>
</div>
<div id="computing-correlation-based-distances" class="section level3">
<h3>Computing correlation based distances</h3>
<pre class="r"><code>library(factoextra)
dist_cor &lt;- df_scaled%&gt;%get_dist(method = &quot;pearson&quot;)
dist_cor</code></pre>
<pre><code>##             1          2          3          4          5          6
## 2  0.39284182                                                       
## 3  1.88323808 1.48124956                                            
## 4  1.51104538 1.95724833 0.73275637                                 
## 5  0.10172943 0.39649801 1.58735835 1.63796515                      
## 6  0.89643432 0.70873731 0.62996195 1.54924589 0.47335304           
## 7  1.88828067 1.63047384 0.42964555 0.33013745 1.99902039 1.54844760
## 8  0.03397220 0.22543935 1.88502852 1.65774350 0.15995476 0.93085531
## 9  0.84488289 1.66338138 1.32301819 0.23171322 1.04250427 1.50433835
## 10 0.79373668 0.13229609 1.25215664 1.78623995 0.87221024 0.98656209
## 11 0.13294458 0.53490262 1.99943383 1.24466481 0.44007040 1.40105329
## 12 1.71026047 1.46307561 0.70139207 0.41080771 1.94546879 1.75426983
## 13 1.28105707 1.91441885 0.91474121 0.03590417 1.41264198 1.49970477
## 14 1.10318723 1.65000415 0.65137671 0.52872771 0.85836307 0.58943546
## 15 1.93694159 1.84486032 0.21444766 0.22771478 1.88379100 1.23370270
##             7          8          9         10         11         12
## 2                                                                   
## 3                                                                   
## 4                                                                   
## 5                                                                   
## 6                                                                   
## 7                                                                   
## 8  1.83904622                                                       
## 9  0.91334724 1.04888744                                            
## 10 1.16126121 0.54945796 1.78375398                                 
## 11 1.54243155 0.12953731 0.66455004 0.75037196                      
## 12 0.05192698 1.62260187 0.89013243 0.97985871 1.26682924           
## 13 0.54882648 1.47102692 0.09638227 1.87117264 1.06724393 0.61411025
## 14 1.11954102 1.34374458 0.48344739 1.90526244 1.35997487 1.36483102
## 15 0.11068503 1.98328683 0.80417038 1.50658241 1.76652553 0.29342437
##            13         14
## 2                       
## 3                       
## 4                       
## 5                       
## 6                       
## 7                       
## 8                       
## 9                       
## 10                      
## 11                      
## 12                      
## 13                      
## 14 0.41994201           
## 15 0.40334920 0.67231284</code></pre>
<pre class="r"><code>round(as.matrix(dist_cor),1)</code></pre>
<pre><code>##      1   2   3   4   5   6   7   8   9  10  11  12  13  14  15
## 1  0.0 0.4 1.9 1.5 0.1 0.9 1.9 0.0 0.8 0.8 0.1 1.7 1.3 1.1 1.9
## 2  0.4 0.0 1.5 2.0 0.4 0.7 1.6 0.2 1.7 0.1 0.5 1.5 1.9 1.7 1.8
## 3  1.9 1.5 0.0 0.7 1.6 0.6 0.4 1.9 1.3 1.3 2.0 0.7 0.9 0.7 0.2
## 4  1.5 2.0 0.7 0.0 1.6 1.5 0.3 1.7 0.2 1.8 1.2 0.4 0.0 0.5 0.2
## 5  0.1 0.4 1.6 1.6 0.0 0.5 2.0 0.2 1.0 0.9 0.4 1.9 1.4 0.9 1.9
## 6  0.9 0.7 0.6 1.5 0.5 0.0 1.5 0.9 1.5 1.0 1.4 1.8 1.5 0.6 1.2
## 7  1.9 1.6 0.4 0.3 2.0 1.5 0.0 1.8 0.9 1.2 1.5 0.1 0.5 1.1 0.1
## 8  0.0 0.2 1.9 1.7 0.2 0.9 1.8 0.0 1.0 0.5 0.1 1.6 1.5 1.3 2.0
## 9  0.8 1.7 1.3 0.2 1.0 1.5 0.9 1.0 0.0 1.8 0.7 0.9 0.1 0.5 0.8
## 10 0.8 0.1 1.3 1.8 0.9 1.0 1.2 0.5 1.8 0.0 0.8 1.0 1.9 1.9 1.5
## 11 0.1 0.5 2.0 1.2 0.4 1.4 1.5 0.1 0.7 0.8 0.0 1.3 1.1 1.4 1.8
## 12 1.7 1.5 0.7 0.4 1.9 1.8 0.1 1.6 0.9 1.0 1.3 0.0 0.6 1.4 0.3
## 13 1.3 1.9 0.9 0.0 1.4 1.5 0.5 1.5 0.1 1.9 1.1 0.6 0.0 0.4 0.4
## 14 1.1 1.7 0.7 0.5 0.9 0.6 1.1 1.3 0.5 1.9 1.4 1.4 0.4 0.0 0.7
## 15 1.9 1.8 0.2 0.2 1.9 1.2 0.1 2.0 0.8 1.5 1.8 0.3 0.4 0.7 0.0</code></pre>
</div>
<div id="computing-distances-for-mixed-data" class="section level3">
<h3>Computing distances for mixed data</h3>
<p>Gower’s metric</p>
<pre class="r"><code>library(cluster)
data(flower)
head(flower,3)</code></pre>
<pre><code>##   V1 V2 V3 V4 V5 V6  V7 V8
## 1  0  1  1  4  3 15  25 15
## 2  1  0  0  2  1  3 150 50
## 3  0  1  0  3  3  1 150 50</code></pre>
<pre class="r"><code>str(flower)</code></pre>
<pre><code>## &#39;data.frame&#39;:    18 obs. of  8 variables:
##  $ V1: Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 2 1 1 1 1 1 1 2 2 ...
##  $ V2: Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 1 2 1 2 2 1 1 2 2 ...
##  $ V3: Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 1 1 2 1 1 1 2 1 1 ...
##  $ V4: Factor w/ 5 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 4 2 3 4 5 4 4 2 3 5 ...
##  $ V5: Ord.factor w/ 3 levels &quot;1&quot;&lt;&quot;2&quot;&lt;&quot;3&quot;: 3 1 3 2 2 3 3 2 1 2 ...
##  $ V6: Ord.factor w/ 18 levels &quot;1&quot;&lt;&quot;2&quot;&lt;&quot;3&quot;&lt;&quot;4&quot;&lt;..: 15 3 1 16 2 12 13 7 4 14 ...
##  $ V7: num  25 150 150 125 20 50 40 100 25 100 ...
##  $ V8: num  15 50 50 50 15 40 20 15 15 60 ...</code></pre>
<pre class="r"><code>dd &lt;- daisy(flower)
dd</code></pre>
<pre><code>## Dissimilarities :
##            1         2         3         4         5         6         7
## 2  0.8875408                                                            
## 3  0.5272467 0.5147059                                                  
## 4  0.3517974 0.5504493 0.5651552                                        
## 5  0.4115605 0.6226307 0.3726307 0.6383578                              
## 6  0.2269199 0.6606209 0.3003268 0.4189951 0.3443627                    
## 7  0.2876225 0.5999183 0.4896242 0.3435866 0.4197712 0.1892974          
## 8  0.4234069 0.4641340 0.6038399 0.2960376 0.4673203 0.5714869 0.4107843
## 9  0.5808824 0.4316585 0.4463644 0.8076797 0.3306781 0.5136846 0.5890931
## 10 0.6094363 0.4531046 0.4678105 0.5570670 0.3812908 0.4119281 0.5865196
## 11 0.3278595 0.7096814 0.5993873 0.6518791 0.3864788 0.4828840 0.5652369
## 12 0.4267565 0.5857843 0.6004902 0.5132761 0.5000817 0.5248366 0.6391340
## 13 0.5196487 0.5248366 0.5395425 0.7464461 0.2919118 0.4524510 0.5278595
## 14 0.2926062 0.5949346 0.6096405 0.3680147 0.5203431 0.3656863 0.5049837
## 15 0.6221814 0.3903595 0.5300654 0.5531454 0.4602124 0.5091503 0.3345588
## 16 0.6935866 0.3575163 0.6222222 0.3417892 0.7301471 0.5107843 0.4353758
## 17 0.7765114 0.1904412 0.5801471 0.4247141 0.6880719 0.5937092 0.5183007
## 18 0.4610294 0.4515114 0.7162173 0.4378268 0.4755310 0.6438317 0.4692402
##            8         9        10        11        12        13        14
## 2                                                                       
## 3                                                                       
## 4                                                                       
## 5                                                                       
## 6                                                                       
## 7                                                                       
## 8                                                                       
## 9  0.6366422                                                            
## 10 0.6639706 0.4256127                                                  
## 11 0.4955474 0.4308007 0.3948121                                        
## 12 0.4216503 0.4194036 0.3812092 0.2636029                              
## 13 0.5754085 0.2181781 0.3643791 0.3445670 0.2331699                    
## 14 0.4558007 0.4396650 0.3609477 0.2838644 0.1591503 0.3784314          
## 15 0.4512255 0.2545343 0.4210784 0.4806781 0.4295752 0.3183007 0.4351307
## 16 0.6378268 0.6494690 0.3488562 0.7436683 0.6050654 0.5882353 0.4598039
## 17 0.4707516 0.6073938 0.3067810 0.7015931 0.5629902 0.5461601 0.5427288
## 18 0.1417892 0.5198529 0.8057598 0.5359477 0.5495507 0.5733252 0.5698121
##           15        16        17
## 2                               
## 3                               
## 4                               
## 5                               
## 6                               
## 7                               
## 8                               
## 9                               
## 10                              
## 11                              
## 12                              
## 13                              
## 14                              
## 15                              
## 16 0.3949346                    
## 17 0.3528595 0.1670752          
## 18 0.5096814 0.7796160 0.6125408
## 
## Metric :  mixed ;  Types = N, N, N, N, O, O, I, I 
## Number of objects : 18</code></pre>
<pre class="r"><code>round(as.matrix(dd),2)</code></pre>
<pre><code>##       1    2    3    4    5    6    7    8    9   10   11   12   13   14
## 1  0.00 0.89 0.53 0.35 0.41 0.23 0.29 0.42 0.58 0.61 0.33 0.43 0.52 0.29
## 2  0.89 0.00 0.51 0.55 0.62 0.66 0.60 0.46 0.43 0.45 0.71 0.59 0.52 0.59
## 3  0.53 0.51 0.00 0.57 0.37 0.30 0.49 0.60 0.45 0.47 0.60 0.60 0.54 0.61
## 4  0.35 0.55 0.57 0.00 0.64 0.42 0.34 0.30 0.81 0.56 0.65 0.51 0.75 0.37
## 5  0.41 0.62 0.37 0.64 0.00 0.34 0.42 0.47 0.33 0.38 0.39 0.50 0.29 0.52
## 6  0.23 0.66 0.30 0.42 0.34 0.00 0.19 0.57 0.51 0.41 0.48 0.52 0.45 0.37
## 7  0.29 0.60 0.49 0.34 0.42 0.19 0.00 0.41 0.59 0.59 0.57 0.64 0.53 0.50
## 8  0.42 0.46 0.60 0.30 0.47 0.57 0.41 0.00 0.64 0.66 0.50 0.42 0.58 0.46
## 9  0.58 0.43 0.45 0.81 0.33 0.51 0.59 0.64 0.00 0.43 0.43 0.42 0.22 0.44
## 10 0.61 0.45 0.47 0.56 0.38 0.41 0.59 0.66 0.43 0.00 0.39 0.38 0.36 0.36
## 11 0.33 0.71 0.60 0.65 0.39 0.48 0.57 0.50 0.43 0.39 0.00 0.26 0.34 0.28
## 12 0.43 0.59 0.60 0.51 0.50 0.52 0.64 0.42 0.42 0.38 0.26 0.00 0.23 0.16
## 13 0.52 0.52 0.54 0.75 0.29 0.45 0.53 0.58 0.22 0.36 0.34 0.23 0.00 0.38
## 14 0.29 0.59 0.61 0.37 0.52 0.37 0.50 0.46 0.44 0.36 0.28 0.16 0.38 0.00
## 15 0.62 0.39 0.53 0.55 0.46 0.51 0.33 0.45 0.25 0.42 0.48 0.43 0.32 0.44
## 16 0.69 0.36 0.62 0.34 0.73 0.51 0.44 0.64 0.65 0.35 0.74 0.61 0.59 0.46
## 17 0.78 0.19 0.58 0.42 0.69 0.59 0.52 0.47 0.61 0.31 0.70 0.56 0.55 0.54
## 18 0.46 0.45 0.72 0.44 0.48 0.64 0.47 0.14 0.52 0.81 0.54 0.55 0.57 0.57
##      15   16   17   18
## 1  0.62 0.69 0.78 0.46
## 2  0.39 0.36 0.19 0.45
## 3  0.53 0.62 0.58 0.72
## 4  0.55 0.34 0.42 0.44
## 5  0.46 0.73 0.69 0.48
## 6  0.51 0.51 0.59 0.64
## 7  0.33 0.44 0.52 0.47
## 8  0.45 0.64 0.47 0.14
## 9  0.25 0.65 0.61 0.52
## 10 0.42 0.35 0.31 0.81
## 11 0.48 0.74 0.70 0.54
## 12 0.43 0.61 0.56 0.55
## 13 0.32 0.59 0.55 0.57
## 14 0.44 0.46 0.54 0.57
## 15 0.00 0.39 0.35 0.51
## 16 0.39 0.00 0.17 0.78
## 17 0.35 0.17 0.00 0.61
## 18 0.51 0.78 0.61 0.00</code></pre>
</div>
<div id="visualize-distance-matricies" class="section level3">
<h3>Visualize distance matricies</h3>
<pre class="r"><code>library(factoextra)
fviz_dist(dist_eucl)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="partitioning-clustering" class="section level1">
<h1>Partitioning Clustering</h1>
<ul>
<li>K-means clustering</li>
<li>K-medoids clustering (PAM)</li>
<li>CLARA algorithm (Clustering Large Applications)</li>
</ul>
<div id="how-it-works" class="section level3">
<h3>How it works</h3>
<ul>
<li>Classify observations in a data-set</li>
<li>Based on similarity</li>
<li>Requires the analyst to specify the number of clusters.</li>
</ul>
</div>
<div id="k-means-clustering" class="section level2">
<h2>K-means clustering</h2>
<pre class="r"><code>data(&quot;USArrests&quot;)
df &lt;- USArrests #%&gt;%sample_n(15)
 
df_scaled &lt;- df%&gt;%mutate_all(.funs =funs(scale(.) %&gt;% as.vector) )
row.names(df_scaled) &lt;- row.names(df)
df_scaled</code></pre>
<pre><code>##                     Murder     Assault    UrbanPop         Rape
## Alabama         1.24256408  0.78283935 -0.52090661 -0.003416473
## Alaska          0.50786248  1.10682252 -1.21176419  2.484202941
## Arizona         0.07163341  1.47880321  0.99898006  1.042878388
## Arkansas        0.23234938  0.23086801 -1.07359268 -0.184916602
## California      0.27826823  1.26281442  1.75892340  2.067820292
## Colorado        0.02571456  0.39885929  0.86080854  1.864967207
## Connecticut    -1.03041900 -0.72908214  0.79172279 -1.081740768
## Delaware       -0.43347395  0.80683810  0.44629400 -0.579946294
## Florida         1.74767144  1.97077766  0.99898006  1.138966691
## Georgia         2.20685994  0.48285493 -0.38273510  0.487701523
## Hawaii         -0.57123050 -1.49704226  1.20623733 -0.110181255
## Idaho          -1.19113497 -0.60908837 -0.79724965 -0.750769945
## Illinois        0.59970018  0.93883125  1.20623733  0.295524916
## Indiana        -0.13500142 -0.69308401 -0.03730631 -0.024769429
## Iowa           -1.28297267 -1.37704849 -0.58999237 -1.060387812
## Kansas         -0.41051452 -0.66908525  0.03177945 -0.345063775
## Kentucky        0.43898421 -0.74108152 -0.93542116 -0.526563903
## Louisiana       1.74767144  0.93883125  0.03177945  0.103348309
## Maine          -1.30593210 -1.05306531 -1.00450692 -1.434064548
## Maryland        0.80633501  1.55079947  0.10086521  0.701231086
## Massachusetts  -0.77786532 -0.26110644  1.34440885 -0.526563903
## Michigan        0.99001041  1.01082751  0.58446551  1.480613993
## Minnesota      -1.16817555 -1.18505846  0.03177945 -0.676034598
## Mississippi     1.90838741  1.05882502 -1.48810723 -0.441152078
## Missouri        0.27826823  0.08687549  0.30812248  0.743936999
## Montana        -0.41051452 -0.74108152 -0.86633540 -0.515887425
## Nebraska       -0.80082475 -0.82507715 -0.24456358 -0.505210947
## Nevada          1.01296983  0.97482938  1.06806582  2.644350114
## New Hampshire  -1.30593210 -1.36504911 -0.65907813 -1.252564419
## New Jersey     -0.08908257 -0.14111267  1.62075188 -0.259651949
## New Mexico      0.82929443  1.37080881  0.30812248  1.160319648
## New York        0.76041616  0.99882813  1.41349461  0.519730957
## North Carolina  1.19664523  1.99477641 -1.41902147 -0.547916860
## North Dakota   -1.60440462 -1.50904164 -1.48810723 -1.487446939
## Ohio           -0.11204199 -0.60908837  0.65355127  0.017936483
## Oklahoma       -0.27275797 -0.23710769  0.16995096 -0.131534211
## Oregon         -0.66306820 -0.14111267  0.10086521  0.861378259
## Pennsylvania   -0.34163624 -0.77707965  0.44629400 -0.676034598
## Rhode Island   -1.00745957  0.03887798  1.48258036 -1.380682157
## South Carolina  1.51807718  1.29881255 -1.21176419  0.135377743
## South Dakota   -0.91562187 -1.01706718 -1.41902147 -0.900240639
## Tennessee       1.24256408  0.20686926 -0.45182086  0.605142783
## Texas           1.12776696  0.36286116  0.99898006  0.455672088
## Utah           -1.05337842 -0.60908837  0.99898006  0.178083656
## Vermont        -1.28297267 -1.47304350 -2.31713632 -1.071064290
## Virginia        0.16347111 -0.17711080 -0.17547783 -0.056798864
## Washington     -0.86970302 -0.30910395  0.51537975  0.530407436
## West Virginia  -0.47939280 -1.07706407 -1.83353601 -1.273917376
## Wisconsin      -1.19113497 -1.41304662  0.03177945 -1.113770203
## Wyoming        -0.22683912 -0.11711392 -0.38273510 -0.601299251</code></pre>
<pre class="r"><code>library(factoextra)
fviz_nbclust(df_scaled,kmeans,method = &quot;wss&quot;)+
  geom_vline(xintercept = 4,linetype=2)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>set.seed(123)
km_res &lt;- kmeans(df_scaled,4,nstart = 25)
print(km_res)</code></pre>
<pre><code>## K-means clustering with 4 clusters of sizes 13, 16, 13, 8
## 
## Cluster means:
##       Murder    Assault   UrbanPop        Rape
## 1 -0.9615407 -1.1066010 -0.9301069 -0.96676331
## 2 -0.4894375 -0.3826001  0.5758298 -0.26165379
## 3  0.6950701  1.0394414  0.7226370  1.27693964
## 4  1.4118898  0.8743346 -0.8145211  0.01927104
## 
## Clustering vector:
##        Alabama         Alaska        Arizona       Arkansas     California 
##              4              3              3              4              3 
##       Colorado    Connecticut       Delaware        Florida        Georgia 
##              3              2              2              3              4 
##         Hawaii          Idaho       Illinois        Indiana           Iowa 
##              2              1              3              2              1 
##         Kansas       Kentucky      Louisiana          Maine       Maryland 
##              2              1              4              1              3 
##  Massachusetts       Michigan      Minnesota    Mississippi       Missouri 
##              2              3              1              4              3 
##        Montana       Nebraska         Nevada  New Hampshire     New Jersey 
##              1              1              3              1              2 
##     New Mexico       New York North Carolina   North Dakota           Ohio 
##              3              3              4              1              2 
##       Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina 
##              2              2              2              2              4 
##   South Dakota      Tennessee          Texas           Utah        Vermont 
##              1              4              3              2              1 
##       Virginia     Washington  West Virginia      Wisconsin        Wyoming 
##              2              2              1              1              2 
## 
## Within cluster sum of squares by cluster:
## [1] 11.952463 16.212213 19.922437  8.316061
##  (between_SS / total_SS =  71.2 %)
## 
## Available components:
## 
## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;    
## [5] &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;        
## [9] &quot;ifault&quot;</code></pre>
<div id="compute-the-mean-for-each-varabiles-by-clusters" class="section level3">
<h3>Compute the mean for each varabiles by clusters</h3>
<div id="build-a-combined-dataset-of-the-usarrests-and-the-clusters" class="section level4">
<h4>Build a combined dataset of the USArrests and the Clusters</h4>
<pre class="r"><code>the_us_arrests &lt;- USArrests
the_us_arrests$state &lt;- rownames(USArrests)

the_clusters &lt;- data.frame(state = names(km_res$cluster),cluster=km_res$cluster)


the_us_arrests &lt;- left_join(the_us_arrests,the_clusters)
the_us_arrests</code></pre>
<pre><code>##    Murder Assault UrbanPop Rape          state cluster
## 1    13.2     236       58 21.2        Alabama       4
## 2    10.0     263       48 44.5         Alaska       3
## 3     8.1     294       80 31.0        Arizona       3
## 4     8.8     190       50 19.5       Arkansas       4
## 5     9.0     276       91 40.6     California       3
## 6     7.9     204       78 38.7       Colorado       3
## 7     3.3     110       77 11.1    Connecticut       2
## 8     5.9     238       72 15.8       Delaware       2
## 9    15.4     335       80 31.9        Florida       3
## 10   17.4     211       60 25.8        Georgia       4
## 11    5.3      46       83 20.2         Hawaii       2
## 12    2.6     120       54 14.2          Idaho       1
## 13   10.4     249       83 24.0       Illinois       3
## 14    7.2     113       65 21.0        Indiana       2
## 15    2.2      56       57 11.3           Iowa       1
## 16    6.0     115       66 18.0         Kansas       2
## 17    9.7     109       52 16.3       Kentucky       1
## 18   15.4     249       66 22.2      Louisiana       4
## 19    2.1      83       51  7.8          Maine       1
## 20   11.3     300       67 27.8       Maryland       3
## 21    4.4     149       85 16.3  Massachusetts       2
## 22   12.1     255       74 35.1       Michigan       3
## 23    2.7      72       66 14.9      Minnesota       1
## 24   16.1     259       44 17.1    Mississippi       4
## 25    9.0     178       70 28.2       Missouri       3
## 26    6.0     109       53 16.4        Montana       1
## 27    4.3     102       62 16.5       Nebraska       1
## 28   12.2     252       81 46.0         Nevada       3
## 29    2.1      57       56  9.5  New Hampshire       1
## 30    7.4     159       89 18.8     New Jersey       2
## 31   11.4     285       70 32.1     New Mexico       3
## 32   11.1     254       86 26.1       New York       3
## 33   13.0     337       45 16.1 North Carolina       4
## 34    0.8      45       44  7.3   North Dakota       1
## 35    7.3     120       75 21.4           Ohio       2
## 36    6.6     151       68 20.0       Oklahoma       2
## 37    4.9     159       67 29.3         Oregon       2
## 38    6.3     106       72 14.9   Pennsylvania       2
## 39    3.4     174       87  8.3   Rhode Island       2
## 40   14.4     279       48 22.5 South Carolina       4
## 41    3.8      86       45 12.8   South Dakota       1
## 42   13.2     188       59 26.9      Tennessee       4
## 43   12.7     201       80 25.5          Texas       3
## 44    3.2     120       80 22.9           Utah       2
## 45    2.2      48       32 11.2        Vermont       1
## 46    8.5     156       63 20.7       Virginia       2
## 47    4.0     145       73 26.2     Washington       2
## 48    5.7      81       39  9.3  West Virginia       1
## 49    2.6      53       66 10.8      Wisconsin       1
## 50    6.8     161       60 15.6        Wyoming       2</code></pre>
</div>
<div id="summarize-the-data-set-to-determine-the-mean" class="section level4">
<h4>Summarize the data set to determine the mean</h4>
<pre class="r"><code>the_us_arrests%&gt;%group_by(cluster)%&gt;%summarise_if(.predicate = is.numeric,.funs = mean)</code></pre>
<pre><code>## # A tibble: 4 x 5
##   cluster Murder Assault UrbanPop  Rape
##     &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1       1   3.6     78.5     52.1  12.2
## 2       2   5.66   139.      73.9  18.8
## 3       3  10.8    257.      76    33.2
## 4       4  13.9    244.      53.8  21.4</code></pre>
</div>
</div>
<div id="visualizing-k-means-clusters" class="section level3">
<h3>Visualizing k-means clusters</h3>
<pre class="r"><code>fviz_cluster(km_res,data = df,
             palette=c(&quot;#C1FFC1&quot;, &quot;#FFB6C1&quot;, &quot;#98F5FF&quot;, &quot;#FFD700&quot;),
             ellipse.type = &quot;euclid&quot;,star.plot=TRUE,repel = TRUE,ggtheme = theme_minimal())</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
</div>
<div id="k-medoids" class="section level2">
<h2>K-medoids</h2>
<p>K-medoids utilize the median to remove the impact of outliers on the cluster.</p>
<ul>
<li>Cluster medoids</li>
<li>Less reactive to noise and outliers</li>
<li>silhouette algorithm determines cluster counts (k)</li>
</ul>
<div id="pam-partioning-arround-medoids" class="section level3">
<h3>PAM (Partioning Arround Medoids)</h3>
</div>
<div id="computing-pam-in-r" class="section level3">
<h3>Computing PAM in R</h3>
<pre class="r"><code>data(&quot;USArrests&quot;)
df &lt;- USArrests #%&gt;%sample_n(15)
 
df_scaled &lt;- df%&gt;%mutate_all(.funs =funs(scale(.) %&gt;% as.vector) )
row.names(df_scaled) &lt;- row.names(df)
df_scaled</code></pre>
<pre><code>##                     Murder     Assault    UrbanPop         Rape
## Alabama         1.24256408  0.78283935 -0.52090661 -0.003416473
## Alaska          0.50786248  1.10682252 -1.21176419  2.484202941
## Arizona         0.07163341  1.47880321  0.99898006  1.042878388
## Arkansas        0.23234938  0.23086801 -1.07359268 -0.184916602
## California      0.27826823  1.26281442  1.75892340  2.067820292
## Colorado        0.02571456  0.39885929  0.86080854  1.864967207
## Connecticut    -1.03041900 -0.72908214  0.79172279 -1.081740768
## Delaware       -0.43347395  0.80683810  0.44629400 -0.579946294
## Florida         1.74767144  1.97077766  0.99898006  1.138966691
## Georgia         2.20685994  0.48285493 -0.38273510  0.487701523
## Hawaii         -0.57123050 -1.49704226  1.20623733 -0.110181255
## Idaho          -1.19113497 -0.60908837 -0.79724965 -0.750769945
## Illinois        0.59970018  0.93883125  1.20623733  0.295524916
## Indiana        -0.13500142 -0.69308401 -0.03730631 -0.024769429
## Iowa           -1.28297267 -1.37704849 -0.58999237 -1.060387812
## Kansas         -0.41051452 -0.66908525  0.03177945 -0.345063775
## Kentucky        0.43898421 -0.74108152 -0.93542116 -0.526563903
## Louisiana       1.74767144  0.93883125  0.03177945  0.103348309
## Maine          -1.30593210 -1.05306531 -1.00450692 -1.434064548
## Maryland        0.80633501  1.55079947  0.10086521  0.701231086
## Massachusetts  -0.77786532 -0.26110644  1.34440885 -0.526563903
## Michigan        0.99001041  1.01082751  0.58446551  1.480613993
## Minnesota      -1.16817555 -1.18505846  0.03177945 -0.676034598
## Mississippi     1.90838741  1.05882502 -1.48810723 -0.441152078
## Missouri        0.27826823  0.08687549  0.30812248  0.743936999
## Montana        -0.41051452 -0.74108152 -0.86633540 -0.515887425
## Nebraska       -0.80082475 -0.82507715 -0.24456358 -0.505210947
## Nevada          1.01296983  0.97482938  1.06806582  2.644350114
## New Hampshire  -1.30593210 -1.36504911 -0.65907813 -1.252564419
## New Jersey     -0.08908257 -0.14111267  1.62075188 -0.259651949
## New Mexico      0.82929443  1.37080881  0.30812248  1.160319648
## New York        0.76041616  0.99882813  1.41349461  0.519730957
## North Carolina  1.19664523  1.99477641 -1.41902147 -0.547916860
## North Dakota   -1.60440462 -1.50904164 -1.48810723 -1.487446939
## Ohio           -0.11204199 -0.60908837  0.65355127  0.017936483
## Oklahoma       -0.27275797 -0.23710769  0.16995096 -0.131534211
## Oregon         -0.66306820 -0.14111267  0.10086521  0.861378259
## Pennsylvania   -0.34163624 -0.77707965  0.44629400 -0.676034598
## Rhode Island   -1.00745957  0.03887798  1.48258036 -1.380682157
## South Carolina  1.51807718  1.29881255 -1.21176419  0.135377743
## South Dakota   -0.91562187 -1.01706718 -1.41902147 -0.900240639
## Tennessee       1.24256408  0.20686926 -0.45182086  0.605142783
## Texas           1.12776696  0.36286116  0.99898006  0.455672088
## Utah           -1.05337842 -0.60908837  0.99898006  0.178083656
## Vermont        -1.28297267 -1.47304350 -2.31713632 -1.071064290
## Virginia        0.16347111 -0.17711080 -0.17547783 -0.056798864
## Washington     -0.86970302 -0.30910395  0.51537975  0.530407436
## West Virginia  -0.47939280 -1.07706407 -1.83353601 -1.273917376
## Wisconsin      -1.19113497 -1.41304662  0.03177945 -1.113770203
## Wyoming        -0.22683912 -0.11711392 -0.38273510 -0.601299251</code></pre>
<p>There are 2 packages that support PAM.
* cluster
* fpc</p>
<pre class="r"><code>install.packages(&quot;cluster&quot;,&quot;fpc&quot;)</code></pre>
<pre class="r"><code>library(cluster)
library(factoextra)
fviz_nbclust(df_scaled, pam, method = &quot;silhouette&quot;) +
  theme_classic()</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre class="r"><code>pam_res &lt;- pam(df_scaled, 2)
pam_res</code></pre>
<pre><code>## Medoids:
##            ID     Murder    Assault   UrbanPop       Rape
## New Mexico 31  0.8292944  1.3708088  0.3081225  1.1603196
## Nebraska   27 -0.8008247 -0.8250772 -0.2445636 -0.5052109
## Clustering vector:
##        Alabama         Alaska        Arizona       Arkansas     California 
##              1              1              1              2              1 
##       Colorado    Connecticut       Delaware        Florida        Georgia 
##              1              2              2              1              1 
##         Hawaii          Idaho       Illinois        Indiana           Iowa 
##              2              2              1              2              2 
##         Kansas       Kentucky      Louisiana          Maine       Maryland 
##              2              2              1              2              1 
##  Massachusetts       Michigan      Minnesota    Mississippi       Missouri 
##              2              1              2              1              1 
##        Montana       Nebraska         Nevada  New Hampshire     New Jersey 
##              2              2              1              2              2 
##     New Mexico       New York North Carolina   North Dakota           Ohio 
##              1              1              1              2              2 
##       Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina 
##              2              2              2              2              1 
##   South Dakota      Tennessee          Texas           Utah        Vermont 
##              2              1              1              2              2 
##       Virginia     Washington  West Virginia      Wisconsin        Wyoming 
##              2              2              2              2              2 
## Objective function:
##    build     swap 
## 1.441358 1.368969 
## 
## Available components:
##  [1] &quot;medoids&quot;    &quot;id.med&quot;     &quot;clustering&quot; &quot;objective&quot;  &quot;isolation&quot; 
##  [6] &quot;clusinfo&quot;   &quot;silinfo&quot;    &quot;diss&quot;       &quot;call&quot;       &quot;data&quot;</code></pre>
<pre class="r"><code>the_us_arrests &lt;- USArrests
the_us_arrests$state &lt;- rownames(USArrests)

the_clusters &lt;- data.frame(state = names(pam_res$cluster),cluster=pam_res$cluster)


the_us_arrests &lt;- left_join(the_us_arrests,the_clusters)</code></pre>
<pre><code>## Joining, by = &quot;state&quot;</code></pre>
<pre><code>## Warning: Column `state` joining character vector and factor, coercing into
## character vector</code></pre>
<pre class="r"><code>the_us_arrests</code></pre>
<pre><code>##    Murder Assault UrbanPop Rape          state cluster
## 1    13.2     236       58 21.2        Alabama       1
## 2    10.0     263       48 44.5         Alaska       1
## 3     8.1     294       80 31.0        Arizona       1
## 4     8.8     190       50 19.5       Arkansas       2
## 5     9.0     276       91 40.6     California       1
## 6     7.9     204       78 38.7       Colorado       1
## 7     3.3     110       77 11.1    Connecticut       2
## 8     5.9     238       72 15.8       Delaware       2
## 9    15.4     335       80 31.9        Florida       1
## 10   17.4     211       60 25.8        Georgia       1
## 11    5.3      46       83 20.2         Hawaii       2
## 12    2.6     120       54 14.2          Idaho       2
## 13   10.4     249       83 24.0       Illinois       1
## 14    7.2     113       65 21.0        Indiana       2
## 15    2.2      56       57 11.3           Iowa       2
## 16    6.0     115       66 18.0         Kansas       2
## 17    9.7     109       52 16.3       Kentucky       2
## 18   15.4     249       66 22.2      Louisiana       1
## 19    2.1      83       51  7.8          Maine       2
## 20   11.3     300       67 27.8       Maryland       1
## 21    4.4     149       85 16.3  Massachusetts       2
## 22   12.1     255       74 35.1       Michigan       1
## 23    2.7      72       66 14.9      Minnesota       2
## 24   16.1     259       44 17.1    Mississippi       1
## 25    9.0     178       70 28.2       Missouri       1
## 26    6.0     109       53 16.4        Montana       2
## 27    4.3     102       62 16.5       Nebraska       2
## 28   12.2     252       81 46.0         Nevada       1
## 29    2.1      57       56  9.5  New Hampshire       2
## 30    7.4     159       89 18.8     New Jersey       2
## 31   11.4     285       70 32.1     New Mexico       1
## 32   11.1     254       86 26.1       New York       1
## 33   13.0     337       45 16.1 North Carolina       1
## 34    0.8      45       44  7.3   North Dakota       2
## 35    7.3     120       75 21.4           Ohio       2
## 36    6.6     151       68 20.0       Oklahoma       2
## 37    4.9     159       67 29.3         Oregon       2
## 38    6.3     106       72 14.9   Pennsylvania       2
## 39    3.4     174       87  8.3   Rhode Island       2
## 40   14.4     279       48 22.5 South Carolina       1
## 41    3.8      86       45 12.8   South Dakota       2
## 42   13.2     188       59 26.9      Tennessee       1
## 43   12.7     201       80 25.5          Texas       1
## 44    3.2     120       80 22.9           Utah       2
## 45    2.2      48       32 11.2        Vermont       2
## 46    8.5     156       63 20.7       Virginia       2
## 47    4.0     145       73 26.2     Washington       2
## 48    5.7      81       39  9.3  West Virginia       2
## 49    2.6      53       66 10.8      Wisconsin       2
## 50    6.8     161       60 15.6        Wyoming       2</code></pre>
<pre class="r"><code>pam_res$medoids</code></pre>
<pre><code>##                Murder    Assault   UrbanPop       Rape
## New Mexico  0.8292944  1.3708088  0.3081225  1.1603196
## Nebraska   -0.8008247 -0.8250772 -0.2445636 -0.5052109</code></pre>
<pre class="r"><code>pam_res$clustering</code></pre>
<pre><code>##        Alabama         Alaska        Arizona       Arkansas     California 
##              1              1              1              2              1 
##       Colorado    Connecticut       Delaware        Florida        Georgia 
##              1              2              2              1              1 
##         Hawaii          Idaho       Illinois        Indiana           Iowa 
##              2              2              1              2              2 
##         Kansas       Kentucky      Louisiana          Maine       Maryland 
##              2              2              1              2              1 
##  Massachusetts       Michigan      Minnesota    Mississippi       Missouri 
##              2              1              2              1              1 
##        Montana       Nebraska         Nevada  New Hampshire     New Jersey 
##              2              2              1              2              2 
##     New Mexico       New York North Carolina   North Dakota           Ohio 
##              1              1              1              2              2 
##       Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina 
##              2              2              2              2              1 
##   South Dakota      Tennessee          Texas           Utah        Vermont 
##              2              1              1              2              2 
##       Virginia     Washington  West Virginia      Wisconsin        Wyoming 
##              2              2              2              2              2</code></pre>
<pre class="r"><code>fviz_cluster(pam_res,palete = c(&quot;#00CDCD&quot;, &quot;#FFA07A&quot;),ellipse.type = &quot;t&quot;,
             repel = TRUE, ggtheme =  theme_classic())</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre class="r"><code>library(fpc)
pamk_res &lt;- fpc::pamk(data = df_scaled)
pamk_res</code></pre>
<pre><code>## $pamobject
## Medoids:
##            ID     Murder    Assault   UrbanPop       Rape
## New Mexico 31  0.8292944  1.3708088  0.3081225  1.1603196
## Nebraska   27 -0.8008247 -0.8250772 -0.2445636 -0.5052109
## Clustering vector:
##        Alabama         Alaska        Arizona       Arkansas     California 
##              1              1              1              2              1 
##       Colorado    Connecticut       Delaware        Florida        Georgia 
##              1              2              2              1              1 
##         Hawaii          Idaho       Illinois        Indiana           Iowa 
##              2              2              1              2              2 
##         Kansas       Kentucky      Louisiana          Maine       Maryland 
##              2              2              1              2              1 
##  Massachusetts       Michigan      Minnesota    Mississippi       Missouri 
##              2              1              2              1              1 
##        Montana       Nebraska         Nevada  New Hampshire     New Jersey 
##              2              2              1              2              2 
##     New Mexico       New York North Carolina   North Dakota           Ohio 
##              1              1              1              2              2 
##       Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina 
##              2              2              2              2              1 
##   South Dakota      Tennessee          Texas           Utah        Vermont 
##              2              1              1              2              2 
##       Virginia     Washington  West Virginia      Wisconsin        Wyoming 
##              2              2              2              2              2 
## Objective function:
##    build     swap 
## 1.441358 1.368969 
## 
## Available components:
##  [1] &quot;medoids&quot;    &quot;id.med&quot;     &quot;clustering&quot; &quot;objective&quot;  &quot;isolation&quot; 
##  [6] &quot;clusinfo&quot;   &quot;silinfo&quot;    &quot;diss&quot;       &quot;call&quot;       &quot;data&quot;      
## 
## $nc
## [1] 2
## 
## $crit
##  [1] 0.0000000 0.4084890 0.3143656 0.3389904 0.3105170 0.2629987 0.2243815
##  [8] 0.2386072 0.2466113 0.2447023</code></pre>
<pre class="r"><code>the_us_arrests &lt;- USArrests
the_us_arrests$state &lt;- rownames(USArrests)

the_clusters &lt;- data.frame(state = names(pamk_res$pamobject$clustering),cluster=pamk_res$pamobject$clustering)


the_us_arrests &lt;- left_join(the_us_arrests,the_clusters)</code></pre>
<pre><code>## Joining, by = &quot;state&quot;</code></pre>
<pre><code>## Warning: Column `state` joining character vector and factor, coercing into
## character vector</code></pre>
<pre class="r"><code>the_us_arrests</code></pre>
<pre><code>##    Murder Assault UrbanPop Rape          state cluster
## 1    13.2     236       58 21.2        Alabama       1
## 2    10.0     263       48 44.5         Alaska       1
## 3     8.1     294       80 31.0        Arizona       1
## 4     8.8     190       50 19.5       Arkansas       2
## 5     9.0     276       91 40.6     California       1
## 6     7.9     204       78 38.7       Colorado       1
## 7     3.3     110       77 11.1    Connecticut       2
## 8     5.9     238       72 15.8       Delaware       2
## 9    15.4     335       80 31.9        Florida       1
## 10   17.4     211       60 25.8        Georgia       1
## 11    5.3      46       83 20.2         Hawaii       2
## 12    2.6     120       54 14.2          Idaho       2
## 13   10.4     249       83 24.0       Illinois       1
## 14    7.2     113       65 21.0        Indiana       2
## 15    2.2      56       57 11.3           Iowa       2
## 16    6.0     115       66 18.0         Kansas       2
## 17    9.7     109       52 16.3       Kentucky       2
## 18   15.4     249       66 22.2      Louisiana       1
## 19    2.1      83       51  7.8          Maine       2
## 20   11.3     300       67 27.8       Maryland       1
## 21    4.4     149       85 16.3  Massachusetts       2
## 22   12.1     255       74 35.1       Michigan       1
## 23    2.7      72       66 14.9      Minnesota       2
## 24   16.1     259       44 17.1    Mississippi       1
## 25    9.0     178       70 28.2       Missouri       1
## 26    6.0     109       53 16.4        Montana       2
## 27    4.3     102       62 16.5       Nebraska       2
## 28   12.2     252       81 46.0         Nevada       1
## 29    2.1      57       56  9.5  New Hampshire       2
## 30    7.4     159       89 18.8     New Jersey       2
## 31   11.4     285       70 32.1     New Mexico       1
## 32   11.1     254       86 26.1       New York       1
## 33   13.0     337       45 16.1 North Carolina       1
## 34    0.8      45       44  7.3   North Dakota       2
## 35    7.3     120       75 21.4           Ohio       2
## 36    6.6     151       68 20.0       Oklahoma       2
## 37    4.9     159       67 29.3         Oregon       2
## 38    6.3     106       72 14.9   Pennsylvania       2
## 39    3.4     174       87  8.3   Rhode Island       2
## 40   14.4     279       48 22.5 South Carolina       1
## 41    3.8      86       45 12.8   South Dakota       2
## 42   13.2     188       59 26.9      Tennessee       1
## 43   12.7     201       80 25.5          Texas       1
## 44    3.2     120       80 22.9           Utah       2
## 45    2.2      48       32 11.2        Vermont       2
## 46    8.5     156       63 20.7       Virginia       2
## 47    4.0     145       73 26.2     Washington       2
## 48    5.7      81       39  9.3  West Virginia       2
## 49    2.6      53       66 10.8      Wisconsin       2
## 50    6.8     161       60 15.6        Wyoming       2</code></pre>
<pre class="r"><code> plot(pamk_res$pamobject)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-31-1.png" width="672" /><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-31-2.png" width="672" /></p>
</div>
</div>
<div id="clara---clustering-large-applications" class="section level2">
<h2>CLARA - Clustering Large Applications</h2>
<p>CLARA extends the k-medoids algorithm to handle big data. It utilizes sampling to handle the large data sets.</p>
<div id="clara-concept" class="section level3">
<h3>CLARA concept</h3>
<p>Minimize Sampling Bias by running multiple samples and comparing the results. Each sample medoid is measured by the avergage dissimilarity of each object.</p>
</div>
<div id="computing-clara-in-r" class="section level3">
<h3>Computing CLARA in R</h3>
<pre class="r"><code>set.seed(1234)
df_clust_1 &lt;- data.frame(x=rnorm(n = 200,mean = 0,sd = 8),y=rnorm(n = 200,mean = 0,sd = 8))
df_clust_2 &lt;- data.frame(x=rnorm(n = 300,mean = 50,sd = 8),y=rnorm(n = 300,mean = 50,sd = 8))
df &lt;- rbind(df_clust_1,df_clust_2)
rownames(df) &lt;- paste0(&quot;S&quot;,1:nrow(df))
df</code></pre>
<pre><code>##                 x            y
## S1    -9.65652600   3.88181456
## S2     2.21943394   5.57415023
## S3     8.67552941   1.48411132
## S4   -18.76558162   5.60586812
## S5     3.43299751   2.49344823
## S6     4.04844714   6.08369890
## S7    -4.59791968  14.73970901
## S8    -4.37305485   8.89890273
## S9    -4.51561599   0.26131166
## S10   -7.12030263  -8.91559172
## S11   -3.81754160   3.34446258
## S12   -7.98709156  -3.20188190
## S13   -6.21003116  11.94794482
## S14    0.51567054 -12.85664752
## S15    7.67595247  -3.32601431
## S16   -0.88228396   3.37606699
## S17   -4.08807605  -1.21389229
## S18   -7.28956333  -4.84920892
## S19   -6.69737344  -2.43776855
## S20   19.32668143   5.03628880
## S21    1.07270576   7.16137584
## S22   -3.92548717   5.28170105
## S23   -3.52438298  18.18786816
## S24    3.67671553   9.38798058
## S25   -5.54976198   2.30167783
## S26  -11.58563928  -5.27816075
## S27    4.59804577  23.35312105
## S28   -8.18924578   5.41932400
## S29   -0.12110640  -5.47456275
## S30   -7.48758881   1.49193666
## S31    8.81838037  -2.59514640
## S32   -3.80474463  -2.19763375
## S33   -5.67552030  -7.46802672
## S34   -4.01006448   0.93476276
## S35  -13.03274775   2.55328191
## S36   -9.34095410  -8.62033698
## S37  -17.44031719 -25.86521706
## S38  -10.72794554  -2.03899722
## S39   -2.35435087   0.23614264
## S40   -3.72718032   4.75419019
## S41   11.59597012   0.47308135
## S42   -8.54914179   3.30719116
## S43   -6.84291707  -8.78217740
## S44   -2.24498402   5.68940206
## S45   -7.95472061   5.75110984
## S46   -7.74811454   2.01320855
## S47   -8.85854554  10.85819549
## S48  -10.01588709   3.23574777
## S49   -4.19062495   2.11491416
## S50   -3.97479966   2.14435123
## S51  -14.44825005   3.49544462
## S52   -4.65660740   8.48099124
## S53   -8.87111700   3.61752317
## S54   -8.11969608   5.30558893
## S55   -1.29847619  -9.09098843
## S56    4.50444655  -2.96398014
## S57   13.18253978  11.81575672
## S58   -6.18682739  -9.79123000
## S59   12.84727703   2.06454710
## S60   -9.26246838   3.24002244
## S61    5.25270771   7.80642657
## S62   20.39192857  -2.79101389
## S63   -0.27808312   1.26900352
## S64   -5.35706864 -14.10604053
## S65   -0.06083805   2.70876838
## S66   14.21667559  -5.33252024
## S67   -9.10886189  -1.90917299
## S68   10.94261744  -9.50212226
## S69   10.63651833   3.07948257
## S70    2.69178238   5.33263613
## S71    0.05514271  -2.43691112
## S72   -3.64374991  14.60008851
## S73   -2.93219146   5.36447496
## S74    5.18629254   7.58906059
## S75   16.56216689  16.39522401
## S76   -1.22718730  -5.20890887
## S77  -11.12560757   6.46895418
## S78   -5.78865422   7.89264491
## S79    2.06609410  -0.04936637
## S80   -2.53647292   2.55241886
## S81   -1.42231966  -8.09457522
## S82   -1.35995261   3.76134038
## S83  -10.97841509  -5.60776265
## S84   -1.39029736   6.50946290
## S85    6.80185806  -6.49144627
## S86    5.58086969   2.55517990
## S87    4.39997881  -6.77218123
## S88   -3.22185580  -1.96610543
## S89   -1.53275016 -12.42287209
## S90   -9.55622304   1.02747226
## S91   -0.42527055   7.88354712
## S92    2.04156801   1.46598018
## S93   13.64771206 -14.12983371
## S94    8.01210602  -4.96426957
## S95   -3.96466754  13.24834430
## S96    2.84440238  14.47844308
## S97   -9.07686435  -9.40029414
## S98    7.02562902  -2.93362607
## S99    7.78333403   2.82900359
## S100  16.96893684   2.55324977
## S101   3.31618827  -4.63965591
## S102  -3.79774779  -7.62622962
## S103   0.52794795  -1.43542870
## S104  -4.01982226   8.07846572
## S105  -6.60798870   0.18901292
## S106   1.33591424  -5.19222576
## S107  -7.17011701  -4.03499378
## S108   1.34548310  12.91513196
## S109   2.83974609  -3.57567849
## S110  -0.41684093   6.10541409
## S111  -1.56747695  11.77374949
## S112  -5.19255801   3.54931923
## S113  -8.87813785  -3.37377496
## S114   6.79419362  -0.32001301
## S115   0.17890021  -3.93823975
## S116   6.64912494   9.82173694
## S117  -9.95430281  -1.19642852
## S118   1.35221131  12.39986707
## S119   5.38533046  -4.49290028
## S120  -0.21021101  -5.17693801
## S121  -1.53113735   1.14505727
## S122  -6.25525317   0.19350918
## S123  16.46529590  -4.03561220
## S124   6.00401163 -12.65117448
## S125  14.59366642   0.24053137
## S126   0.64047713  -5.73261359
## S127  -5.05127439   8.66088764
## S128 -12.10630496  -7.62148364
## S129  -5.08879865   9.01186183
## S130   1.81041226  -5.19234414
## S131   8.10952278   2.33976063
## S132   2.02200108   7.18962180
## S133  -9.37558650  -4.14993885
## S134   5.34971463   4.43550842
## S135 -13.20080748  -0.70378937
## S136  -2.92681799  -9.08170344
## S137  -2.52894663  -2.16063689
## S138 -15.58596838  12.95831902
## S139   7.36046018  -1.71304939
## S140  -4.98297276  -6.54225970
## S141  -2.67229320  -0.43218339
## S142  11.16118314   2.64113288
## S143   5.09339529   7.64259692
## S144  -0.86745358   9.15167902
## S145   4.11010223   0.80417919
## S146   3.19417446   9.31660197
## S147  13.30285158  -6.11407958
## S148   2.20714723 -18.75610724
## S149   4.05018099  -3.77346740
## S150   2.78041580  -4.12684392
## S151  -3.01790118 -18.52828921
## S152   0.78095570   4.49977406
## S153  13.10995716  -6.27020112
## S154  -7.00473979  -1.80843189
## S155   0.97407999 -12.69682390
## S156  10.89704529   4.38019361
## S157  -1.87696870  15.12981614
## S158  -8.42706246  -7.02461688
## S159  -6.95826885  -0.90047129
## S160  -3.12101624  15.58970452
## S161  -6.77880059   7.47053066
## S162  -2.08511514  15.30447537
## S163  -3.31535765  -0.04187246
## S164  -1.46440638  -1.21808039
## S165   3.25644878  -4.07705326
## S166   4.99706503  11.47658963
## S167  13.42564595 -10.28670826
## S168  -0.54954923   2.45851372
## S169  -2.56671930  -0.37054827
## S170  11.76804574  18.01473440
## S171  13.63463518  -4.86426983
## S172   0.34595230 -12.07430536
## S173  -2.66125855   1.86105416
## S174 -14.57788334  -0.31718957
## S175  11.29009919  -6.71300054
## S176  -6.70065947   1.05832871
## S177  -8.99010236  -2.20419797
## S178  24.35012709  -5.43006913
## S179   1.88017047   4.00668745
## S180  -0.26606888  -2.65329850
## S181 -21.85775618 -14.67984201
## S182  -0.79832471 -21.21392999
## S183   7.80825388  -4.64465738
## S184   3.31095132  11.63349497
## S185   7.29857729   6.70503504
## S186  15.86985761   9.72042864
## S187   9.35286811   7.86004354
## S188  -4.06989612   2.52611219
## S189   5.63344143 -12.05650102
## S190  -1.58733019   1.64455830
## S191  -4.30456631  12.77782472
## S192 -22.84606924 -27.16850828
## S193  -6.31717482  -6.25081827
## S194   3.90251708   8.81971713
## S195  17.34426032   4.22996016
## S196   4.00555691   6.31515523
## S197   4.96168163   3.65679605
## S198  -7.72722568   4.31066493
## S199   1.30123766   0.11714498
## S200 -16.62590034  -7.33191309
## S201  40.18547927  53.63921679
## S202  50.28922295  61.40336552
## S203  46.62885509  48.32807062
## S204  42.80508473  40.14877777
## S205  53.33953054  47.11517138
## S206  51.22755789  45.62229360
## S207  61.70626436  52.62396806
## S208  41.02798002  42.53360134
## S209  45.85769534  55.44648660
## S210  49.40042329  40.68894080
## S211  38.73767935  64.04359608
## S212  47.72235306  61.59709891
## S213  44.33463057  46.40964047
## S214  32.81888799  51.12053831
## S215  47.72930272  47.01079737
## S216  45.72742269  40.34852706
## S217  59.06408155  28.70923220
## S218  45.16744862  49.79924405
## S219  54.46009276  49.72501394
## S220  51.14103435  63.13887231
## S221  40.10511828  34.03630282
## S222  52.99315178  44.70263393
## S223  49.15131101  57.04030394
## S224  51.32849589  52.73909936
## S225  55.26427879  50.97403084
## S226  50.91170336  45.03391172
## S227  62.68127331  51.60756214
## S228  50.92442752  48.11275722
## S229  39.96800769  50.90928892
## S230  55.93491823  45.37656644
## S231  40.21678708  59.50851909
## S232  34.64884695  58.47949022
## S233  43.52050888  60.69406569
## S234  44.04258217  47.06264663
## S235  45.13995262  47.56530636
## S236  62.85407653  47.19776301
## S237  63.08479557  60.99315810
## S238  55.80872877  47.60223606
## S239  39.80932060  50.78108115
## S240  50.18517244  53.04950423
## S241  53.89696987  55.42570045
## S242  48.90377997  47.85861382
## S243  51.37396386  68.76772531
## S244  42.44164868  42.58004276
## S245  39.69903755  38.58754261
## S246  61.26212591  50.33842132
## S247  52.13898151  64.13954776
## S248  46.73281886  50.42200262
## S249  52.60216976  50.87780832
## S250  66.49984778  56.90562092
## S251  52.90133565  49.20821436
## S252  61.29123716  50.82957237
## S253  60.94035452  59.66787901
## S254  46.74259082  50.74996817
## S255  56.10033385  43.98242785
## S256  44.79039342  53.15939376
## S257  38.21075376  41.26783653
## S258  40.38667363  38.33366060
## S259  48.81023617  49.01830172
## S260  64.37649943  41.19256647
## S261  50.83846974  54.64738457
## S262  43.57729621  48.82442009
## S263  51.84299971  43.86932308
## S264  55.58380155  62.98318063
## S265  39.63838614  49.12047565
## S266  41.56255826  61.37363883
## S267  34.46714008  49.09263161
## S268  39.84351526  47.36575247
## S269  42.90048951  52.98768787
## S270  47.66467390  58.23910505
## S271  61.28075242  71.64620038
## S272  57.10913144  41.72043303
## S273  52.18379456  48.53256113
## S274  45.46686827  58.62217046
## S275  49.67834450  52.73296180
## S276  54.38089796  48.50125101
## S277  45.96773343  39.57712713
## S278  58.47256104  47.77073390
## S279  58.77962853  48.52196873
## S280  40.66796296  49.34578002
## S281  44.02470952  62.89793435
## S282  59.65390987  46.30448128
## S283  36.50224096  37.39159759
## S284  53.35767916  53.97146459
## S285  51.86799009  49.10436973
## S286  75.56720958  48.36522880
## S287  28.16255727  55.08454530
## S288  43.27363359  26.74660837
## S289  55.39222935  45.57073398
## S290  63.39461208  48.77238537
## S291  56.71749667  54.84232413
## S292  38.57305252  47.91194723
## S293  67.91510535  41.95889230
## S294  35.94187021  52.98052891
## S295  41.09587130  50.15556941
## S296  49.65487688  50.88423052
## S297  67.80469527  59.25256350
## S298  54.05053270  45.66223632
## S299  55.84316841  40.00638973
## S300  63.82462076  39.75989923
## S301  57.87823975  41.80853770
## S302  40.20209699  38.89879536
## S303  55.67780974  49.60623108
## S304  49.12624006  64.48768584
## S305  64.26086316  49.20391947
## S306  48.05244256  56.21789699
## S307  37.78314382  41.17922940
## S308  53.93467497  48.22684174
## S309  52.83602929  54.52875970
## S310  49.85898922  47.16032524
## S311  41.54759742  56.28210081
## S312  43.28868267  55.55237903
## S313  49.89899427  44.93816084
## S314  58.30488117  43.82433086
## S315  47.08433829  68.86253910
## S316  43.02840422  48.45960531
## S317  28.36637580  50.05295467
## S318  53.95399869  49.56363180
## S319  53.41872260  45.45434496
## S320  60.47352688  42.58419245
## S321  61.73378114  40.91411855
## S322  48.85555147  57.31169871
## S323  60.38810981  42.11149733
## S324  50.01050838  55.33988331
## S325  44.58871939  61.25276392
## S326  43.21442722  59.26223168
## S327  47.22447120  48.88997442
## S328  51.81983554  45.68542519
## S329  49.78078877  41.36885201
## S330  51.60702232  49.85150288
## S331  51.59154137  48.13907451
## S332  55.71679485  51.25034834
## S333  47.81454580  45.16792196
## S334  63.08277966  55.03228096
## S335  53.50155109  55.71335657
## S336  40.45171319  58.60708881
## S337  47.78680157  67.99804414
## S338  54.12706440  51.58312479
## S339  46.71155734  45.39562945
## S340  52.75996040  49.38143308
## S341  53.47516689  36.97664089
## S342  60.42782146  51.03938523
## S343  44.78643271  46.59461493
## S344  49.86495310  53.24809399
## S345  45.45846036  47.84951851
## S346  40.98293704  38.95212371
## S347  35.20823751  50.29266657
## S348  51.56423244  39.17404375
## S349  54.81252180  57.17604955
## S350  55.11326528  35.36512230
## S351  38.88005746  48.86498445
## S352  40.96257717  53.66385422
## S353  40.87076644  37.84305990
## S354  44.49062800  61.19244252
## S355  51.36158255  42.91728647
## S356  54.75586742  45.94935767
## S357  43.47973879  51.30665685
## S358  27.08522530  47.30284915
## S359  57.63058785  41.71238774
## S360  54.92227816  53.27470343
## S361  44.39303440  45.80621233
## S362  41.41070927  54.05200299
## S363  47.60007043  45.96221710
## S364  50.86485250  42.34199737
## S365  55.78560611  49.24292513
## S366  61.12076077  55.19551454
## S367  43.20893281  51.93857439
## S368  52.32578276  49.52852728
## S369  60.67340827  34.41764743
## S370  42.78926276  61.61154906
## S371  48.21789270  49.68048258
## S372  35.82825577  43.08801847
## S373  52.29937800  48.38647808
## S374  44.87046590  52.09004450
## S375  42.60049886  37.85318893
## S376  43.76018025  55.73846906
## S377  53.55602699  51.97466182
## S378  32.70024798  59.62213637
## S379  46.59591280  57.88831416
## S380  41.89025873  45.69647521
## S381  42.30304777  46.07773807
## S382  53.79707702  42.03587062
## S383  52.81403416  47.10637657
## S384  49.14383715  57.55483849
## S385  54.30013805  64.33765609
## S386  45.18316081  57.42727517
## S387  33.81361884  35.36049864
## S388  59.23537024  56.57502485
## S389  48.15445602  58.29015010
## S390  47.07928985  54.93936115
## S391  51.26014344  43.16055710
## S392  56.12745778  58.51608415
## S393  53.40869573  55.83585166
## S394  57.41812320  55.30125267
## S395  50.36907674  46.94874238
## S396  45.96571486  56.76713422
## S397  47.59640473  50.89273508
## S398  56.58332783  49.45783791
## S399  43.20584963  61.89678477
## S400  42.37111923  56.05778701
## S401  52.50782973  27.00766005
## S402  54.89978646  46.58766041
## S403  36.47133418  38.10074963
## S404  56.27758902  54.71033317
## S405  50.09540108  46.45920391
## S406  48.54995770  57.21043842
## S407  58.85563522  53.74262672
## S408  61.83515897  50.17632255
## S409  40.82080447  49.31913735
## S410  58.09323501  47.10986286
## S411  44.94344644  51.59605201
## S412  51.05889056  41.13396596
## S413  53.84740852  55.38235256
## S414  51.06542102  46.84709093
## S415  38.29708430  44.04825932
## S416  45.94878576  47.39109219
## S417  62.31730590  64.99735061
## S418  51.38234895  35.93600684
## S419  43.31340861  47.20911272
## S420  44.75257037  50.85271383
## S421  58.46052869  45.69872975
## S422  52.76866792  46.70984694
## S423  42.82250766  53.05878670
## S424  50.05012169  51.78011271
## S425  54.77336407  44.60996393
## S426  63.78041446  54.53946331
## S427  42.94600413  51.43586924
## S428  46.96043236  55.49073400
## S429  57.96888013  39.38189071
## S430  46.32703286  43.85666849
## S431  61.68212597  48.45837993
## S432  58.34596942  57.67240958
## S433  36.72767224  45.76774910
## S434  53.39166221  41.73690407
## S435  38.64669659  56.17396392
## S436  38.28246035  53.72285331
## S437  50.56336778  40.19463146
## S438  50.45358578  66.37341792
## S439  49.73833458  61.98939559
## S440  60.11424979  38.88840732
## S441  52.35990309  67.22701171
## S442  44.61530544  36.16706608
## S443  50.95670633  50.81633988
## S444  45.88482793  40.86976698
## S445  49.45510741  46.98392729
## S446  40.81590471  47.20974321
## S447  49.07804416  52.58308065
## S448  50.82349113  41.00528306
## S449  44.38605210  27.94360222
## S450  50.32984499  49.23351121
## S451  44.80985320  44.02640156
## S452  44.84793712  51.68625134
## S453  48.36448940  43.21192153
## S454  53.92672734  56.33811813
## S455  48.35730410  50.23349946
## S456  51.52553059  54.82710410
## S457  57.76019354  42.04047916
## S458  47.71791138  48.30934033
## S459  49.17104585  52.75216870
## S460  54.09003633  49.28497177
## S461  39.93470040  63.23229973
## S462  54.35060775  34.29673029
## S463  45.72029131  56.04900409
## S464  40.89563179  50.11534926
## S465  35.85596983  57.56571043
## S466  44.28017438  49.20953206
## S467  40.63838189  28.08196605
## S468  40.57241481  53.36244680
## S469  63.01833070  48.25296590
## S470  40.30282667  42.08515736
## S471  57.98007934  44.74824883
## S472  54.36196513  50.44530839
## S473  42.92168708  69.61650756
## S474  45.11015442  51.50538859
## S475  46.71840390  42.16242905
## S476  51.52327496  65.22888374
## S477  47.21340057  46.49184174
## S478  56.61478024  43.36219124
## S479  47.65850478  40.02214945
## S480  32.67723032  44.60952670
## S481  49.23026579  65.48133811
## S482  35.18434523  57.25249148
## S483  57.50248908  55.89221417
## S484  44.01850815  51.17300243
## S485  41.07806851  52.26496637
## S486  45.26794868  54.71421377
## S487  54.68184547  51.72679581
## S488  34.65153441  51.24042588
## S489  52.03053433  57.63061309
## S490  42.22206587  48.67317838
## S491  49.93189242  52.04002996
## S492  55.43233529  42.82022113
## S493  54.55705093  62.67176084
## S494  62.02369329  61.14206903
## S495  51.03268321  35.50193415
## S496  44.39053639  48.26944257
## S497  67.22965773  54.39884845
## S498  47.57403089  53.86188990
## S499  56.46063822  56.08678983
## S500  57.44793173  46.43473586</code></pre>
</div>
<div id="required-r-packages-and-functions" class="section level3">
<h3>Required R packages and functions</h3>
<p><strong>Packages:</strong> cluster, factoextra
<strong>functions:</strong>
clara()</p>
</div>
<div id="estimating-the-optimal-number-of-clusters" class="section level3">
<h3>Estimating the optimal number of clusters</h3>
<p>Utilize factoextra::fviz_nbclust() function to determine the correct number of clusters.</p>
<pre class="r"><code>library(cluster)
library(factoextra)
fviz_nbclust(df,clara,method = &quot;silhouette&quot;) +
  theme_classic()</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-33"></span>
<img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-33-1.png" alt="The number of clusters created in the simulated data frame is 2.  The results from the optimal cluster determination is 2." width="672" />
<p class="caption">
Figure 1: The number of clusters created in the simulated data frame is 2. The results from the optimal cluster determination is 2.
</p>
</div>
</div>
<div id="computing-clara" class="section level3">
<h3>Computing CLARA</h3>
<pre class="r"><code>clara_res &lt;- clara(df, 2, samples = 50, pamLike = TRUE)

knitr::knit_print(clara_res)</code></pre>
<pre><code>## Call:     clara(x = df, k = 2, samples = 50, pamLike = TRUE) 
## Medoids:
##              x         y
## S121 -1.531137  1.145057
## S455 48.357304 50.233499
## Objective function:   9.87862
## Clustering vector:    Named int [1:500] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 ...
##  - attr(*, &quot;names&quot;)= chr [1:500] &quot;S1&quot; &quot;S2&quot; &quot;S3&quot; &quot;S4&quot; &quot;S5&quot; &quot;S6&quot; &quot;S7&quot; ...
## Cluster sizes:            200 300 
## Best sample:
##  [1] S37  S49  S54  S63  S68  S71  S76  S80  S82  S101 S103 S108 S109 S118
## [15] S121 S128 S132 S138 S144 S162 S203 S210 S216 S231 S234 S249 S260 S261
## [29] S286 S299 S304 S305 S312 S315 S322 S350 S403 S450 S454 S455 S456 S465
## [43] S488 S497
## 
## Available components:
##  [1] &quot;sample&quot;     &quot;medoids&quot;    &quot;i.med&quot;      &quot;clustering&quot; &quot;objective&quot; 
##  [6] &quot;clusinfo&quot;   &quot;diss&quot;       &quot;call&quot;       &quot;silinfo&quot;    &quot;data&quot;</code></pre>
<pre class="r"><code>df$id &lt;- rownames(df)
df &lt;- df%&gt;%select(id,x,y)
clustering &lt;- data.frame(id= names(clara_res$clustering), cluster = clara_res$clustering)
df &lt;- left_join(df,clustering)
df</code></pre>
<pre><code>##       id            x            y cluster
## 1     S1  -9.65652600   3.88181456       1
## 2     S2   2.21943394   5.57415023       1
## 3     S3   8.67552941   1.48411132       1
## 4     S4 -18.76558162   5.60586812       1
## 5     S5   3.43299751   2.49344823       1
## 6     S6   4.04844714   6.08369890       1
## 7     S7  -4.59791968  14.73970901       1
## 8     S8  -4.37305485   8.89890273       1
## 9     S9  -4.51561599   0.26131166       1
## 10   S10  -7.12030263  -8.91559172       1
## 11   S11  -3.81754160   3.34446258       1
## 12   S12  -7.98709156  -3.20188190       1
## 13   S13  -6.21003116  11.94794482       1
## 14   S14   0.51567054 -12.85664752       1
## 15   S15   7.67595247  -3.32601431       1
## 16   S16  -0.88228396   3.37606699       1
## 17   S17  -4.08807605  -1.21389229       1
## 18   S18  -7.28956333  -4.84920892       1
## 19   S19  -6.69737344  -2.43776855       1
## 20   S20  19.32668143   5.03628880       1
## 21   S21   1.07270576   7.16137584       1
## 22   S22  -3.92548717   5.28170105       1
## 23   S23  -3.52438298  18.18786816       1
## 24   S24   3.67671553   9.38798058       1
## 25   S25  -5.54976198   2.30167783       1
## 26   S26 -11.58563928  -5.27816075       1
## 27   S27   4.59804577  23.35312105       1
## 28   S28  -8.18924578   5.41932400       1
## 29   S29  -0.12110640  -5.47456275       1
## 30   S30  -7.48758881   1.49193666       1
## 31   S31   8.81838037  -2.59514640       1
## 32   S32  -3.80474463  -2.19763375       1
## 33   S33  -5.67552030  -7.46802672       1
## 34   S34  -4.01006448   0.93476276       1
## 35   S35 -13.03274775   2.55328191       1
## 36   S36  -9.34095410  -8.62033698       1
## 37   S37 -17.44031719 -25.86521706       1
## 38   S38 -10.72794554  -2.03899722       1
## 39   S39  -2.35435087   0.23614264       1
## 40   S40  -3.72718032   4.75419019       1
## 41   S41  11.59597012   0.47308135       1
## 42   S42  -8.54914179   3.30719116       1
## 43   S43  -6.84291707  -8.78217740       1
## 44   S44  -2.24498402   5.68940206       1
## 45   S45  -7.95472061   5.75110984       1
## 46   S46  -7.74811454   2.01320855       1
## 47   S47  -8.85854554  10.85819549       1
## 48   S48 -10.01588709   3.23574777       1
## 49   S49  -4.19062495   2.11491416       1
## 50   S50  -3.97479966   2.14435123       1
## 51   S51 -14.44825005   3.49544462       1
## 52   S52  -4.65660740   8.48099124       1
## 53   S53  -8.87111700   3.61752317       1
## 54   S54  -8.11969608   5.30558893       1
## 55   S55  -1.29847619  -9.09098843       1
## 56   S56   4.50444655  -2.96398014       1
## 57   S57  13.18253978  11.81575672       1
## 58   S58  -6.18682739  -9.79123000       1
## 59   S59  12.84727703   2.06454710       1
## 60   S60  -9.26246838   3.24002244       1
## 61   S61   5.25270771   7.80642657       1
## 62   S62  20.39192857  -2.79101389       1
## 63   S63  -0.27808312   1.26900352       1
## 64   S64  -5.35706864 -14.10604053       1
## 65   S65  -0.06083805   2.70876838       1
## 66   S66  14.21667559  -5.33252024       1
## 67   S67  -9.10886189  -1.90917299       1
## 68   S68  10.94261744  -9.50212226       1
## 69   S69  10.63651833   3.07948257       1
## 70   S70   2.69178238   5.33263613       1
## 71   S71   0.05514271  -2.43691112       1
## 72   S72  -3.64374991  14.60008851       1
## 73   S73  -2.93219146   5.36447496       1
## 74   S74   5.18629254   7.58906059       1
## 75   S75  16.56216689  16.39522401       1
## 76   S76  -1.22718730  -5.20890887       1
## 77   S77 -11.12560757   6.46895418       1
## 78   S78  -5.78865422   7.89264491       1
## 79   S79   2.06609410  -0.04936637       1
## 80   S80  -2.53647292   2.55241886       1
## 81   S81  -1.42231966  -8.09457522       1
## 82   S82  -1.35995261   3.76134038       1
## 83   S83 -10.97841509  -5.60776265       1
## 84   S84  -1.39029736   6.50946290       1
## 85   S85   6.80185806  -6.49144627       1
## 86   S86   5.58086969   2.55517990       1
## 87   S87   4.39997881  -6.77218123       1
## 88   S88  -3.22185580  -1.96610543       1
## 89   S89  -1.53275016 -12.42287209       1
## 90   S90  -9.55622304   1.02747226       1
## 91   S91  -0.42527055   7.88354712       1
## 92   S92   2.04156801   1.46598018       1
## 93   S93  13.64771206 -14.12983371       1
## 94   S94   8.01210602  -4.96426957       1
## 95   S95  -3.96466754  13.24834430       1
## 96   S96   2.84440238  14.47844308       1
## 97   S97  -9.07686435  -9.40029414       1
## 98   S98   7.02562902  -2.93362607       1
## 99   S99   7.78333403   2.82900359       1
## 100 S100  16.96893684   2.55324977       1
## 101 S101   3.31618827  -4.63965591       1
## 102 S102  -3.79774779  -7.62622962       1
## 103 S103   0.52794795  -1.43542870       1
## 104 S104  -4.01982226   8.07846572       1
## 105 S105  -6.60798870   0.18901292       1
## 106 S106   1.33591424  -5.19222576       1
## 107 S107  -7.17011701  -4.03499378       1
## 108 S108   1.34548310  12.91513196       1
## 109 S109   2.83974609  -3.57567849       1
## 110 S110  -0.41684093   6.10541409       1
## 111 S111  -1.56747695  11.77374949       1
## 112 S112  -5.19255801   3.54931923       1
## 113 S113  -8.87813785  -3.37377496       1
## 114 S114   6.79419362  -0.32001301       1
## 115 S115   0.17890021  -3.93823975       1
## 116 S116   6.64912494   9.82173694       1
## 117 S117  -9.95430281  -1.19642852       1
## 118 S118   1.35221131  12.39986707       1
## 119 S119   5.38533046  -4.49290028       1
## 120 S120  -0.21021101  -5.17693801       1
## 121 S121  -1.53113735   1.14505727       1
## 122 S122  -6.25525317   0.19350918       1
## 123 S123  16.46529590  -4.03561220       1
## 124 S124   6.00401163 -12.65117448       1
## 125 S125  14.59366642   0.24053137       1
## 126 S126   0.64047713  -5.73261359       1
## 127 S127  -5.05127439   8.66088764       1
## 128 S128 -12.10630496  -7.62148364       1
## 129 S129  -5.08879865   9.01186183       1
## 130 S130   1.81041226  -5.19234414       1
## 131 S131   8.10952278   2.33976063       1
## 132 S132   2.02200108   7.18962180       1
## 133 S133  -9.37558650  -4.14993885       1
## 134 S134   5.34971463   4.43550842       1
## 135 S135 -13.20080748  -0.70378937       1
## 136 S136  -2.92681799  -9.08170344       1
## 137 S137  -2.52894663  -2.16063689       1
## 138 S138 -15.58596838  12.95831902       1
## 139 S139   7.36046018  -1.71304939       1
## 140 S140  -4.98297276  -6.54225970       1
## 141 S141  -2.67229320  -0.43218339       1
## 142 S142  11.16118314   2.64113288       1
## 143 S143   5.09339529   7.64259692       1
## 144 S144  -0.86745358   9.15167902       1
## 145 S145   4.11010223   0.80417919       1
## 146 S146   3.19417446   9.31660197       1
## 147 S147  13.30285158  -6.11407958       1
## 148 S148   2.20714723 -18.75610724       1
## 149 S149   4.05018099  -3.77346740       1
## 150 S150   2.78041580  -4.12684392       1
## 151 S151  -3.01790118 -18.52828921       1
## 152 S152   0.78095570   4.49977406       1
## 153 S153  13.10995716  -6.27020112       1
## 154 S154  -7.00473979  -1.80843189       1
## 155 S155   0.97407999 -12.69682390       1
## 156 S156  10.89704529   4.38019361       1
## 157 S157  -1.87696870  15.12981614       1
## 158 S158  -8.42706246  -7.02461688       1
## 159 S159  -6.95826885  -0.90047129       1
## 160 S160  -3.12101624  15.58970452       1
## 161 S161  -6.77880059   7.47053066       1
## 162 S162  -2.08511514  15.30447537       1
## 163 S163  -3.31535765  -0.04187246       1
## 164 S164  -1.46440638  -1.21808039       1
## 165 S165   3.25644878  -4.07705326       1
## 166 S166   4.99706503  11.47658963       1
## 167 S167  13.42564595 -10.28670826       1
## 168 S168  -0.54954923   2.45851372       1
## 169 S169  -2.56671930  -0.37054827       1
## 170 S170  11.76804574  18.01473440       1
## 171 S171  13.63463518  -4.86426983       1
## 172 S172   0.34595230 -12.07430536       1
## 173 S173  -2.66125855   1.86105416       1
## 174 S174 -14.57788334  -0.31718957       1
## 175 S175  11.29009919  -6.71300054       1
## 176 S176  -6.70065947   1.05832871       1
## 177 S177  -8.99010236  -2.20419797       1
## 178 S178  24.35012709  -5.43006913       1
## 179 S179   1.88017047   4.00668745       1
## 180 S180  -0.26606888  -2.65329850       1
## 181 S181 -21.85775618 -14.67984201       1
## 182 S182  -0.79832471 -21.21392999       1
## 183 S183   7.80825388  -4.64465738       1
## 184 S184   3.31095132  11.63349497       1
## 185 S185   7.29857729   6.70503504       1
## 186 S186  15.86985761   9.72042864       1
## 187 S187   9.35286811   7.86004354       1
## 188 S188  -4.06989612   2.52611219       1
## 189 S189   5.63344143 -12.05650102       1
## 190 S190  -1.58733019   1.64455830       1
## 191 S191  -4.30456631  12.77782472       1
## 192 S192 -22.84606924 -27.16850828       1
## 193 S193  -6.31717482  -6.25081827       1
## 194 S194   3.90251708   8.81971713       1
## 195 S195  17.34426032   4.22996016       1
## 196 S196   4.00555691   6.31515523       1
## 197 S197   4.96168163   3.65679605       1
## 198 S198  -7.72722568   4.31066493       1
## 199 S199   1.30123766   0.11714498       1
## 200 S200 -16.62590034  -7.33191309       1
## 201 S201  40.18547927  53.63921679       2
## 202 S202  50.28922295  61.40336552       2
## 203 S203  46.62885509  48.32807062       2
## 204 S204  42.80508473  40.14877777       2
## 205 S205  53.33953054  47.11517138       2
## 206 S206  51.22755789  45.62229360       2
## 207 S207  61.70626436  52.62396806       2
## 208 S208  41.02798002  42.53360134       2
## 209 S209  45.85769534  55.44648660       2
## 210 S210  49.40042329  40.68894080       2
## 211 S211  38.73767935  64.04359608       2
## 212 S212  47.72235306  61.59709891       2
## 213 S213  44.33463057  46.40964047       2
## 214 S214  32.81888799  51.12053831       2
## 215 S215  47.72930272  47.01079737       2
## 216 S216  45.72742269  40.34852706       2
## 217 S217  59.06408155  28.70923220       2
## 218 S218  45.16744862  49.79924405       2
## 219 S219  54.46009276  49.72501394       2
## 220 S220  51.14103435  63.13887231       2
## 221 S221  40.10511828  34.03630282       2
## 222 S222  52.99315178  44.70263393       2
## 223 S223  49.15131101  57.04030394       2
## 224 S224  51.32849589  52.73909936       2
## 225 S225  55.26427879  50.97403084       2
## 226 S226  50.91170336  45.03391172       2
## 227 S227  62.68127331  51.60756214       2
## 228 S228  50.92442752  48.11275722       2
## 229 S229  39.96800769  50.90928892       2
## 230 S230  55.93491823  45.37656644       2
## 231 S231  40.21678708  59.50851909       2
## 232 S232  34.64884695  58.47949022       2
## 233 S233  43.52050888  60.69406569       2
## 234 S234  44.04258217  47.06264663       2
## 235 S235  45.13995262  47.56530636       2
## 236 S236  62.85407653  47.19776301       2
## 237 S237  63.08479557  60.99315810       2
## 238 S238  55.80872877  47.60223606       2
## 239 S239  39.80932060  50.78108115       2
## 240 S240  50.18517244  53.04950423       2
## 241 S241  53.89696987  55.42570045       2
## 242 S242  48.90377997  47.85861382       2
## 243 S243  51.37396386  68.76772531       2
## 244 S244  42.44164868  42.58004276       2
## 245 S245  39.69903755  38.58754261       2
## 246 S246  61.26212591  50.33842132       2
## 247 S247  52.13898151  64.13954776       2
## 248 S248  46.73281886  50.42200262       2
## 249 S249  52.60216976  50.87780832       2
## 250 S250  66.49984778  56.90562092       2
## 251 S251  52.90133565  49.20821436       2
## 252 S252  61.29123716  50.82957237       2
## 253 S253  60.94035452  59.66787901       2
## 254 S254  46.74259082  50.74996817       2
## 255 S255  56.10033385  43.98242785       2
## 256 S256  44.79039342  53.15939376       2
## 257 S257  38.21075376  41.26783653       2
## 258 S258  40.38667363  38.33366060       2
## 259 S259  48.81023617  49.01830172       2
## 260 S260  64.37649943  41.19256647       2
## 261 S261  50.83846974  54.64738457       2
## 262 S262  43.57729621  48.82442009       2
## 263 S263  51.84299971  43.86932308       2
## 264 S264  55.58380155  62.98318063       2
## 265 S265  39.63838614  49.12047565       2
## 266 S266  41.56255826  61.37363883       2
## 267 S267  34.46714008  49.09263161       2
## 268 S268  39.84351526  47.36575247       2
## 269 S269  42.90048951  52.98768787       2
## 270 S270  47.66467390  58.23910505       2
## 271 S271  61.28075242  71.64620038       2
## 272 S272  57.10913144  41.72043303       2
## 273 S273  52.18379456  48.53256113       2
## 274 S274  45.46686827  58.62217046       2
## 275 S275  49.67834450  52.73296180       2
## 276 S276  54.38089796  48.50125101       2
## 277 S277  45.96773343  39.57712713       2
## 278 S278  58.47256104  47.77073390       2
## 279 S279  58.77962853  48.52196873       2
## 280 S280  40.66796296  49.34578002       2
## 281 S281  44.02470952  62.89793435       2
## 282 S282  59.65390987  46.30448128       2
## 283 S283  36.50224096  37.39159759       2
## 284 S284  53.35767916  53.97146459       2
## 285 S285  51.86799009  49.10436973       2
## 286 S286  75.56720958  48.36522880       2
## 287 S287  28.16255727  55.08454530       2
## 288 S288  43.27363359  26.74660837       2
## 289 S289  55.39222935  45.57073398       2
## 290 S290  63.39461208  48.77238537       2
## 291 S291  56.71749667  54.84232413       2
## 292 S292  38.57305252  47.91194723       2
## 293 S293  67.91510535  41.95889230       2
## 294 S294  35.94187021  52.98052891       2
## 295 S295  41.09587130  50.15556941       2
## 296 S296  49.65487688  50.88423052       2
## 297 S297  67.80469527  59.25256350       2
## 298 S298  54.05053270  45.66223632       2
## 299 S299  55.84316841  40.00638973       2
## 300 S300  63.82462076  39.75989923       2
## 301 S301  57.87823975  41.80853770       2
## 302 S302  40.20209699  38.89879536       2
## 303 S303  55.67780974  49.60623108       2
## 304 S304  49.12624006  64.48768584       2
## 305 S305  64.26086316  49.20391947       2
## 306 S306  48.05244256  56.21789699       2
## 307 S307  37.78314382  41.17922940       2
## 308 S308  53.93467497  48.22684174       2
## 309 S309  52.83602929  54.52875970       2
## 310 S310  49.85898922  47.16032524       2
## 311 S311  41.54759742  56.28210081       2
## 312 S312  43.28868267  55.55237903       2
## 313 S313  49.89899427  44.93816084       2
## 314 S314  58.30488117  43.82433086       2
## 315 S315  47.08433829  68.86253910       2
## 316 S316  43.02840422  48.45960531       2
## 317 S317  28.36637580  50.05295467       2
## 318 S318  53.95399869  49.56363180       2
## 319 S319  53.41872260  45.45434496       2
## 320 S320  60.47352688  42.58419245       2
## 321 S321  61.73378114  40.91411855       2
## 322 S322  48.85555147  57.31169871       2
## 323 S323  60.38810981  42.11149733       2
## 324 S324  50.01050838  55.33988331       2
## 325 S325  44.58871939  61.25276392       2
## 326 S326  43.21442722  59.26223168       2
## 327 S327  47.22447120  48.88997442       2
## 328 S328  51.81983554  45.68542519       2
## 329 S329  49.78078877  41.36885201       2
## 330 S330  51.60702232  49.85150288       2
## 331 S331  51.59154137  48.13907451       2
## 332 S332  55.71679485  51.25034834       2
## 333 S333  47.81454580  45.16792196       2
## 334 S334  63.08277966  55.03228096       2
## 335 S335  53.50155109  55.71335657       2
## 336 S336  40.45171319  58.60708881       2
## 337 S337  47.78680157  67.99804414       2
## 338 S338  54.12706440  51.58312479       2
## 339 S339  46.71155734  45.39562945       2
## 340 S340  52.75996040  49.38143308       2
## 341 S341  53.47516689  36.97664089       2
## 342 S342  60.42782146  51.03938523       2
## 343 S343  44.78643271  46.59461493       2
## 344 S344  49.86495310  53.24809399       2
## 345 S345  45.45846036  47.84951851       2
## 346 S346  40.98293704  38.95212371       2
## 347 S347  35.20823751  50.29266657       2
## 348 S348  51.56423244  39.17404375       2
## 349 S349  54.81252180  57.17604955       2
## 350 S350  55.11326528  35.36512230       2
## 351 S351  38.88005746  48.86498445       2
## 352 S352  40.96257717  53.66385422       2
## 353 S353  40.87076644  37.84305990       2
## 354 S354  44.49062800  61.19244252       2
## 355 S355  51.36158255  42.91728647       2
## 356 S356  54.75586742  45.94935767       2
## 357 S357  43.47973879  51.30665685       2
## 358 S358  27.08522530  47.30284915       2
## 359 S359  57.63058785  41.71238774       2
## 360 S360  54.92227816  53.27470343       2
## 361 S361  44.39303440  45.80621233       2
## 362 S362  41.41070927  54.05200299       2
## 363 S363  47.60007043  45.96221710       2
## 364 S364  50.86485250  42.34199737       2
## 365 S365  55.78560611  49.24292513       2
## 366 S366  61.12076077  55.19551454       2
## 367 S367  43.20893281  51.93857439       2
## 368 S368  52.32578276  49.52852728       2
## 369 S369  60.67340827  34.41764743       2
## 370 S370  42.78926276  61.61154906       2
## 371 S371  48.21789270  49.68048258       2
## 372 S372  35.82825577  43.08801847       2
## 373 S373  52.29937800  48.38647808       2
## 374 S374  44.87046590  52.09004450       2
## 375 S375  42.60049886  37.85318893       2
## 376 S376  43.76018025  55.73846906       2
## 377 S377  53.55602699  51.97466182       2
## 378 S378  32.70024798  59.62213637       2
## 379 S379  46.59591280  57.88831416       2
## 380 S380  41.89025873  45.69647521       2
## 381 S381  42.30304777  46.07773807       2
## 382 S382  53.79707702  42.03587062       2
## 383 S383  52.81403416  47.10637657       2
## 384 S384  49.14383715  57.55483849       2
## 385 S385  54.30013805  64.33765609       2
## 386 S386  45.18316081  57.42727517       2
## 387 S387  33.81361884  35.36049864       2
## 388 S388  59.23537024  56.57502485       2
## 389 S389  48.15445602  58.29015010       2
## 390 S390  47.07928985  54.93936115       2
## 391 S391  51.26014344  43.16055710       2
## 392 S392  56.12745778  58.51608415       2
## 393 S393  53.40869573  55.83585166       2
## 394 S394  57.41812320  55.30125267       2
## 395 S395  50.36907674  46.94874238       2
## 396 S396  45.96571486  56.76713422       2
## 397 S397  47.59640473  50.89273508       2
## 398 S398  56.58332783  49.45783791       2
## 399 S399  43.20584963  61.89678477       2
## 400 S400  42.37111923  56.05778701       2
## 401 S401  52.50782973  27.00766005       2
## 402 S402  54.89978646  46.58766041       2
## 403 S403  36.47133418  38.10074963       2
## 404 S404  56.27758902  54.71033317       2
## 405 S405  50.09540108  46.45920391       2
## 406 S406  48.54995770  57.21043842       2
## 407 S407  58.85563522  53.74262672       2
## 408 S408  61.83515897  50.17632255       2
## 409 S409  40.82080447  49.31913735       2
## 410 S410  58.09323501  47.10986286       2
## 411 S411  44.94344644  51.59605201       2
## 412 S412  51.05889056  41.13396596       2
## 413 S413  53.84740852  55.38235256       2
## 414 S414  51.06542102  46.84709093       2
## 415 S415  38.29708430  44.04825932       2
## 416 S416  45.94878576  47.39109219       2
## 417 S417  62.31730590  64.99735061       2
## 418 S418  51.38234895  35.93600684       2
## 419 S419  43.31340861  47.20911272       2
## 420 S420  44.75257037  50.85271383       2
## 421 S421  58.46052869  45.69872975       2
## 422 S422  52.76866792  46.70984694       2
## 423 S423  42.82250766  53.05878670       2
## 424 S424  50.05012169  51.78011271       2
## 425 S425  54.77336407  44.60996393       2
## 426 S426  63.78041446  54.53946331       2
## 427 S427  42.94600413  51.43586924       2
## 428 S428  46.96043236  55.49073400       2
## 429 S429  57.96888013  39.38189071       2
## 430 S430  46.32703286  43.85666849       2
## 431 S431  61.68212597  48.45837993       2
## 432 S432  58.34596942  57.67240958       2
## 433 S433  36.72767224  45.76774910       2
## 434 S434  53.39166221  41.73690407       2
## 435 S435  38.64669659  56.17396392       2
## 436 S436  38.28246035  53.72285331       2
## 437 S437  50.56336778  40.19463146       2
## 438 S438  50.45358578  66.37341792       2
## 439 S439  49.73833458  61.98939559       2
## 440 S440  60.11424979  38.88840732       2
## 441 S441  52.35990309  67.22701171       2
## 442 S442  44.61530544  36.16706608       2
## 443 S443  50.95670633  50.81633988       2
## 444 S444  45.88482793  40.86976698       2
## 445 S445  49.45510741  46.98392729       2
## 446 S446  40.81590471  47.20974321       2
## 447 S447  49.07804416  52.58308065       2
## 448 S448  50.82349113  41.00528306       2
## 449 S449  44.38605210  27.94360222       2
## 450 S450  50.32984499  49.23351121       2
## 451 S451  44.80985320  44.02640156       2
## 452 S452  44.84793712  51.68625134       2
## 453 S453  48.36448940  43.21192153       2
## 454 S454  53.92672734  56.33811813       2
## 455 S455  48.35730410  50.23349946       2
## 456 S456  51.52553059  54.82710410       2
## 457 S457  57.76019354  42.04047916       2
## 458 S458  47.71791138  48.30934033       2
## 459 S459  49.17104585  52.75216870       2
## 460 S460  54.09003633  49.28497177       2
## 461 S461  39.93470040  63.23229973       2
## 462 S462  54.35060775  34.29673029       2
## 463 S463  45.72029131  56.04900409       2
## 464 S464  40.89563179  50.11534926       2
## 465 S465  35.85596983  57.56571043       2
## 466 S466  44.28017438  49.20953206       2
## 467 S467  40.63838189  28.08196605       2
## 468 S468  40.57241481  53.36244680       2
## 469 S469  63.01833070  48.25296590       2
## 470 S470  40.30282667  42.08515736       2
## 471 S471  57.98007934  44.74824883       2
## 472 S472  54.36196513  50.44530839       2
## 473 S473  42.92168708  69.61650756       2
## 474 S474  45.11015442  51.50538859       2
## 475 S475  46.71840390  42.16242905       2
## 476 S476  51.52327496  65.22888374       2
## 477 S477  47.21340057  46.49184174       2
## 478 S478  56.61478024  43.36219124       2
## 479 S479  47.65850478  40.02214945       2
## 480 S480  32.67723032  44.60952670       2
## 481 S481  49.23026579  65.48133811       2
## 482 S482  35.18434523  57.25249148       2
## 483 S483  57.50248908  55.89221417       2
## 484 S484  44.01850815  51.17300243       2
## 485 S485  41.07806851  52.26496637       2
## 486 S486  45.26794868  54.71421377       2
## 487 S487  54.68184547  51.72679581       2
## 488 S488  34.65153441  51.24042588       2
## 489 S489  52.03053433  57.63061309       2
## 490 S490  42.22206587  48.67317838       2
## 491 S491  49.93189242  52.04002996       2
## 492 S492  55.43233529  42.82022113       2
## 493 S493  54.55705093  62.67176084       2
## 494 S494  62.02369329  61.14206903       2
## 495 S495  51.03268321  35.50193415       2
## 496 S496  44.39053639  48.26944257       2
## 497 S497  67.22965773  54.39884845       2
## 498 S498  47.57403089  53.86188990       2
## 499 S499  56.46063822  56.08678983       2
## 500 S500  57.44793173  46.43473586       2</code></pre>
<pre class="r"><code>clara_res$medoids</code></pre>
<pre><code>##              x         y
## S121 -1.531137  1.145057
## S455 48.357304 50.233499</code></pre>
</div>
<div id="visualizing-clara-clusters" class="section level3">
<h3>Visualizing CLARA clusters</h3>
<pre class="r"><code>fviz_cluster(clara_res,palette=c(&quot;#008B8B&quot;, &quot;#EE3B3B&quot;),ellipse.type = &quot;t&quot;,geom = &quot;point&quot;,ggtheme = theme_classic()
             )</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div id="summary" class="section level3">
<h3>Summary</h3>
<p>The CLARA algorithm is an extension to the PAM clustering method for large data sets. You must specify the number of clusters.</p>
</div>
</div>
</div>
<div id="hierachial-clustering" class="section level1">
<h1>Hierachial Clustering</h1>
<p>Also known as <em>Hierarchial cluster analysis</em> <strong>(HCA)</strong></p>
<p>There are two types of Hierachial Clusting</p>
<ul>
<li>Agglomerative</li>
<li>Divisive</li>
</ul>
<p>Agglomearative is from the bottom up and Divisive is from the top down.</p>
<p>The term dendogram is used to describe the hierarchial structure of clustering.</p>
<div id="agglomerative-clustering" class="section level2">
<h2>Agglomerative Clustering</h2>
<p>This clustering method initially assigns each observation as its own cluster (leaf), and then iterates to find common leafs that will match together to create the next level of cluster.</p>
<div id="algorithm" class="section level3">
<h3>Algorithm</h3>
</div>
<div id="data-structure-and-preparation" class="section level3">
<h3>Data Structure and preparation</h3>
<pre class="r"><code>set.seed(123)
data(&quot;USArrests&quot;)
df &lt;- USArrests
 
df_scaled &lt;- df%&gt;%mutate_all(.funs =funs(scale(.) %&gt;% as.vector) )
row.names(df_scaled) &lt;- row.names(df)
head(df_scaled)</code></pre>
<pre><code>##                Murder   Assault   UrbanPop         Rape
## Alabama    1.24256408 0.7828393 -0.5209066 -0.003416473
## Alaska     0.50786248 1.1068225 -1.2117642  2.484202941
## Arizona    0.07163341 1.4788032  0.9989801  1.042878388
## Arkansas   0.23234938 0.2308680 -1.0735927 -0.184916602
## California 0.27826823 1.2628144  1.7589234  2.067820292
## Colorado   0.02571456 0.3988593  0.8608085  1.864967207</code></pre>
</div>
<div id="similarity-measures" class="section level3">
<h3>Similarity Measures</h3>
<pre class="r"><code>res_dist &lt;- df_scaled%&gt;%dist(method = &quot;euclidian&quot;)
head(res_dist)</code></pre>
<pre><code>## [1] 2.703754 2.293520 1.289810 3.263110 2.651067 3.215297</code></pre>
</div>
<div id="linkage" class="section level3">
<h3>Linkage</h3>
<pre class="r"><code>res_hc &lt;- hclust(d = res_dist,method = &quot;ward.D2&quot;)</code></pre>
</div>
<div id="dendogram" class="section level3">
<h3>Dendogram</h3>
<pre class="r"><code>library(factoextra)
fviz_dend(res_hc, cex = 0.8)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
</div>
<div id="verify-the-cluster-tree" class="section level3">
<h3>Verify the cluster tree</h3>
<pre class="r"><code>res_coph &lt;- cophenetic(res_hc)


cor(res_dist,res_coph)</code></pre>
<pre><code>## [1] 0.6975266</code></pre>
<pre class="r"><code>res_hc2 &lt;- hclust(res_dist, method=&quot;average&quot;)
cor(res_dist,cophenetic(res_hc2))</code></pre>
<pre><code>## [1] 0.7180382</code></pre>
</div>
<div id="cut-the-dendogram-into-different-groups" class="section level3">
<h3>Cut the dendogram into different groups</h3>
<pre class="r"><code>grp &lt;- cutree(res_hc,k = 4)
grp</code></pre>
<pre><code>##        Alabama         Alaska        Arizona       Arkansas     California 
##              1              2              2              3              2 
##       Colorado    Connecticut       Delaware        Florida        Georgia 
##              2              3              3              2              1 
##         Hawaii          Idaho       Illinois        Indiana           Iowa 
##              3              4              2              3              4 
##         Kansas       Kentucky      Louisiana          Maine       Maryland 
##              3              3              1              4              2 
##  Massachusetts       Michigan      Minnesota    Mississippi       Missouri 
##              3              2              4              1              3 
##        Montana       Nebraska         Nevada  New Hampshire     New Jersey 
##              4              4              2              4              3 
##     New Mexico       New York North Carolina   North Dakota           Ohio 
##              2              2              1              4              3 
##       Oklahoma         Oregon   Pennsylvania   Rhode Island South Carolina 
##              3              3              3              3              1 
##   South Dakota      Tennessee          Texas           Utah        Vermont 
##              4              1              2              3              4 
##       Virginia     Washington  West Virginia      Wisconsin        Wyoming 
##              3              3              4              4              3</code></pre>
<pre class="r"><code>table(grp)</code></pre>
<pre><code>## grp
##  1  2  3  4 
##  7 12 19 12</code></pre>
<pre class="r"><code>str(grp)</code></pre>
<pre><code>##  Named int [1:50] 1 2 2 3 2 2 3 3 2 1 ...
##  - attr(*, &quot;names&quot;)= chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...</code></pre>
<pre class="r"><code>fviz_dend(res_hc,k = 4, cex = 0.5, k_colors = c(&quot;cornflowerblue&quot;, &quot;aquamarine&quot;, &quot;darkorange2&quot;, &quot;darkkhaki&quot;),
          color_labels_by_k = TRUE,
          rect = TRUE)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<pre class="r"><code>fviz_cluster(list(data=df,cluster = grp),
             palette =  c(&quot;cornflowerblue&quot;, &quot;aquamarine&quot;, &quot;darkorange2&quot;, &quot;darkkhaki&quot;),
             ellipse.type = &quot;convex&quot;,
             repel = TRUE,
             show.clust.cent = FALSE,
             ggtheme = theme_minimal())</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
<div id="cluster-r-package" class="section level3">
<h3>Cluster R package</h3>
<p>Agglomerative Nesting (Hierarchial Clustering)</p>
<pre class="r"><code>library(cluster)
res_agnes  &lt;- agnes(x = USArrests, 
                    stand = TRUE,
                    metric = &quot;euclidean&quot;,
                    method = &quot;ward&quot;)
res_agnes</code></pre>
<pre><code>## Call:     agnes(x = USArrests, metric = &quot;euclidean&quot;, stand = TRUE, method = &quot;ward&quot;) 
## Agglomerative coefficient:  0.934098 
## Order of objects:
##  [1] Alabama        Louisiana      Georgia        Tennessee     
##  [5] Mississippi    South Carolina North Carolina Alaska        
##  [9] California     Nevada         Colorado       Arizona       
## [13] Maryland       New Mexico     Michigan       Florida       
## [17] Illinois       New York       Texas          Arkansas      
## [21] Kentucky       Virginia       Wyoming        Indiana       
## [25] Kansas         Oklahoma       Ohio           Pennsylvania  
## [29] Missouri       Oregon         Washington     Connecticut   
## [33] Rhode Island   Delaware       Hawaii         Utah          
## [37] Massachusetts  New Jersey     Idaho          Montana       
## [41] Nebraska       Iowa           New Hampshire  Maine         
## [45] Minnesota      Wisconsin      North Dakota   Vermont       
## [49] South Dakota   West Virginia 
## Height (summary):
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2620  0.9627  1.3332  2.2033  2.2249 16.3214 
## 
## Available components:
## [1] &quot;order&quot;     &quot;height&quot;    &quot;ac&quot;        &quot;merge&quot;     &quot;diss&quot;      &quot;call&quot;     
## [7] &quot;method&quot;    &quot;order.lab&quot; &quot;data&quot;</code></pre>
<p>DIvisive ANAlysis Clustering</p>
<pre class="r"><code>res_diana &lt;- diana(x = USArrests,
                   stand = TRUE,
                   metric = &quot;euclidean&quot;)

res_diana</code></pre>
<pre><code>## Merge:
##       [,1] [,2]
##  [1,]  -15  -29
##  [2,]  -13  -32
##  [3,]  -23  -49
##  [4,]  -14  -36
##  [5,]  -20  -31
##  [6,]  -16  -38
##  [7,]  -37  -47
##  [8,]    1  -19
##  [9,]    4  -35
## [10,]  -41  -48
## [11,]  -46  -50
## [12,]  -12  -27
## [13,]  -21  -30
## [14,]  -24  -40
## [15,]    2  -43
## [16,]  -17  -26
## [17,]   -1  -42
## [18,]  -10  -18
## [19,]    9    6
## [20,]   -4   11
## [21,]  -11  -44
## [22,]   -7  -39
## [23,]    8  -34
## [24,]   10  -45
## [25,]    5  -22
## [26,]   17   18
## [27,]   14  -33
## [28,]   12    3
## [29,]   -5  -28
## [30,]   -3   25
## [31,]   29   -6
## [32,]   15  -25
## [33,]   30   32
## [34,]   22   13
## [35,]   23   24
## [36,]   19    7
## [37,]   20   -8
## [38,]   34   21
## [39,]   28   16
## [40,]   37   36
## [41,]   26   27
## [42,]   39   35
## [43,]   33   -9
## [44,]   43   31
## [45,]   40   38
## [46,]   -2   44
## [47,]   45   42
## [48,]   41   46
## [49,]   48   47
## Order of objects:
##  [1] Alabama        Tennessee      Georgia        Louisiana     
##  [5] Mississippi    South Carolina North Carolina Alaska        
##  [9] Arizona        Maryland       New Mexico     Michigan      
## [13] Illinois       New York       Texas          Missouri      
## [17] Florida        California     Nevada         Colorado      
## [21] Arkansas       Virginia       Wyoming        Delaware      
## [25] Indiana        Oklahoma       Ohio           Kansas        
## [29] Pennsylvania   Oregon         Washington     Connecticut   
## [33] Rhode Island   Massachusetts  New Jersey     Hawaii        
## [37] Utah           Idaho          Nebraska       Minnesota     
## [41] Wisconsin      Kentucky       Montana        Iowa          
## [45] New Hampshire  Maine          North Dakota   South Dakota  
## [49] West Virginia  Vermont       
## Height:
##  [1] 1.0340801 1.3687929 1.0408349 2.8205587 0.9771986 1.3960934 5.4623592
##  [8] 4.0837483 1.4720236 0.6743186 1.3385319 1.9655812 0.4336501 1.0044328
## [15] 1.8355779 2.9848751 3.0534495 1.4621581 1.7044355 7.4792599 1.2084105
## [22] 0.8788445 2.1852059 2.5927716 0.6281577 0.8500187 1.0553617 0.6765523
## [29] 2.1808837 0.7311305 3.7810250 1.2903008 1.9665793 0.9626545 2.5032675
## [36] 1.2698293 5.3463933 0.9132211 1.4571402 0.6215418 2.5227753 1.0181020
## [43] 2.9549994 0.2619577 0.7930730 1.2918266 2.1082699 0.8721679 1.3129132
## Divisive coefficient:
## [1] 0.8530481
## 
## Available components:
## [1] &quot;order&quot;     &quot;height&quot;    &quot;dc&quot;        &quot;merge&quot;     &quot;diss&quot;      &quot;call&quot;     
## [7] &quot;order.lab&quot; &quot;data&quot;</code></pre>
<p>Visualize</p>
<pre class="r"><code>library(factoextra)
fviz_dend(res_agnes, cex = 0.6, k = 4)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="comparing-dendograms" class="section level1">
<h1>Comparing Dendograms</h1>
<pre class="r"><code>data(&quot;USArrests&quot;)
df &lt;- USArrests #%&gt;%sample_n(15)
 
df_scaled &lt;- df%&gt;%mutate_all(.funs =funs(scale(.) %&gt;% as.vector) )
row.names(df_scaled) &lt;- row.names(df)
df_scaled</code></pre>
<pre><code>##                     Murder     Assault    UrbanPop         Rape
## Alabama         1.24256408  0.78283935 -0.52090661 -0.003416473
## Alaska          0.50786248  1.10682252 -1.21176419  2.484202941
## Arizona         0.07163341  1.47880321  0.99898006  1.042878388
## Arkansas        0.23234938  0.23086801 -1.07359268 -0.184916602
## California      0.27826823  1.26281442  1.75892340  2.067820292
## Colorado        0.02571456  0.39885929  0.86080854  1.864967207
## Connecticut    -1.03041900 -0.72908214  0.79172279 -1.081740768
## Delaware       -0.43347395  0.80683810  0.44629400 -0.579946294
## Florida         1.74767144  1.97077766  0.99898006  1.138966691
## Georgia         2.20685994  0.48285493 -0.38273510  0.487701523
## Hawaii         -0.57123050 -1.49704226  1.20623733 -0.110181255
## Idaho          -1.19113497 -0.60908837 -0.79724965 -0.750769945
## Illinois        0.59970018  0.93883125  1.20623733  0.295524916
## Indiana        -0.13500142 -0.69308401 -0.03730631 -0.024769429
## Iowa           -1.28297267 -1.37704849 -0.58999237 -1.060387812
## Kansas         -0.41051452 -0.66908525  0.03177945 -0.345063775
## Kentucky        0.43898421 -0.74108152 -0.93542116 -0.526563903
## Louisiana       1.74767144  0.93883125  0.03177945  0.103348309
## Maine          -1.30593210 -1.05306531 -1.00450692 -1.434064548
## Maryland        0.80633501  1.55079947  0.10086521  0.701231086
## Massachusetts  -0.77786532 -0.26110644  1.34440885 -0.526563903
## Michigan        0.99001041  1.01082751  0.58446551  1.480613993
## Minnesota      -1.16817555 -1.18505846  0.03177945 -0.676034598
## Mississippi     1.90838741  1.05882502 -1.48810723 -0.441152078
## Missouri        0.27826823  0.08687549  0.30812248  0.743936999
## Montana        -0.41051452 -0.74108152 -0.86633540 -0.515887425
## Nebraska       -0.80082475 -0.82507715 -0.24456358 -0.505210947
## Nevada          1.01296983  0.97482938  1.06806582  2.644350114
## New Hampshire  -1.30593210 -1.36504911 -0.65907813 -1.252564419
## New Jersey     -0.08908257 -0.14111267  1.62075188 -0.259651949
## New Mexico      0.82929443  1.37080881  0.30812248  1.160319648
## New York        0.76041616  0.99882813  1.41349461  0.519730957
## North Carolina  1.19664523  1.99477641 -1.41902147 -0.547916860
## North Dakota   -1.60440462 -1.50904164 -1.48810723 -1.487446939
## Ohio           -0.11204199 -0.60908837  0.65355127  0.017936483
## Oklahoma       -0.27275797 -0.23710769  0.16995096 -0.131534211
## Oregon         -0.66306820 -0.14111267  0.10086521  0.861378259
## Pennsylvania   -0.34163624 -0.77707965  0.44629400 -0.676034598
## Rhode Island   -1.00745957  0.03887798  1.48258036 -1.380682157
## South Carolina  1.51807718  1.29881255 -1.21176419  0.135377743
## South Dakota   -0.91562187 -1.01706718 -1.41902147 -0.900240639
## Tennessee       1.24256408  0.20686926 -0.45182086  0.605142783
## Texas           1.12776696  0.36286116  0.99898006  0.455672088
## Utah           -1.05337842 -0.60908837  0.99898006  0.178083656
## Vermont        -1.28297267 -1.47304350 -2.31713632 -1.071064290
## Virginia        0.16347111 -0.17711080 -0.17547783 -0.056798864
## Washington     -0.86970302 -0.30910395  0.51537975  0.530407436
## West Virginia  -0.47939280 -1.07706407 -1.83353601 -1.273917376
## Wisconsin      -1.19113497 -1.41304662  0.03177945 -1.113770203
## Wyoming        -0.22683912 -0.11711392 -0.38273510 -0.601299251</code></pre>
<div id="sample-10-rows" class="section level3">
<h3>Sample 10 rows</h3>
<pre class="r"><code>library(dplyr)
set.seed(123)
df_sample &lt;- df_scaled%&gt;%sample_n(10)
head(df_sample)</code></pre>
<pre><code>##        Murder     Assault   UrbanPop       Rape
## 1 -1.28297267 -1.37704849 -0.5899924 -1.0603878
## 2 -1.00745957  0.03887798  1.4825804 -1.3806822
## 3  0.80633501  1.55079947  0.1008652  0.7012311
## 4  1.24256408  0.20686926 -0.4518209  0.6051428
## 5 -1.05337842 -0.60908837  0.9989801  0.1780837
## 6  0.07163341  1.47880321  0.9989801  1.0428784</code></pre>
</div>
<div id="comparing-dendograms-1" class="section level2">
<h2>Comparing dendograms</h2>
<pre class="r"><code>library(dendextend)
res_dist &lt;- dist(df_sample, method = &quot;euclidean&quot;)

hc1 &lt;- hclust(res_dist, method = &quot;average&quot;)
hc2 &lt;- hclust(res_dist, method = &quot;ward.D2&quot;)


dend1 &lt;- as.dendrogram(hc1)
dend2 &lt;- as.dendrogram(hc2)

dend_list &lt;- dendlist(dend1,dend2)</code></pre>
<pre class="r"><code>tanglegram(dend1,dend2)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<pre class="r"><code>tanglegram(dend1,dend2,
           highlight_distinct_edges = FALSE,
           common_subtrees_color_lines = FALSE,
           common_subtrees_color_branches = TRUE,
           main = paste(&quot;entanglement =&quot;,round(entanglement(dend_list),2)))</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div id="correlation-matrix-between-a-list-of-dendograms" class="section level3">
<h3>Correlation matrix between a list of dendograms</h3>
<pre class="r"><code>library(cluster)
cor.dendlist(dend_list,method = &quot;cophenetic&quot;)</code></pre>
<pre><code>##           [,1]      [,2]
## [1,] 1.0000000 0.9646883
## [2,] 0.9646883 1.0000000</code></pre>
<pre class="r"><code>cor.dendlist(dend_list,method = &quot;baker&quot;)</code></pre>
<pre><code>##           [,1]      [,2]
## [1,] 1.0000000 0.9622885
## [2,] 0.9622885 1.0000000</code></pre>
<pre class="r"><code>cor_cophenetic(dend1,dend2)</code></pre>
<pre><code>## [1] 0.9646883</code></pre>
<pre class="r"><code>cor_bakers_gamma(dend1,dend2)</code></pre>
<pre><code>## [1] 0.9622885</code></pre>
<pre class="r"><code>dend1 &lt;- df_sample%&gt;%dist%&gt;% hclust(&quot;complete&quot; ) %&gt;% as.dendrogram
dend2 &lt;- df_sample%&gt;%dist%&gt;% hclust(&quot;single&quot; ) %&gt;% as.dendrogram
dend3 &lt;- df_sample%&gt;%dist%&gt;% hclust(&quot;average&quot; ) %&gt;% as.dendrogram
dend4 &lt;- df_sample%&gt;%dist%&gt;% hclust(&quot;centroid&quot; ) %&gt;% as.dendrogram

dend_list &lt;- dendlist(&quot;Complete&quot;= dend1, &quot;Single&quot; = dend2,
                      &quot;Average&quot;=dend3, &quot;Centroid&quot;= dend4)

cors &lt;-- cor.dendlist(dend_list)
round(cors, 2)</code></pre>
<pre><code>##          Complete Single Average Centroid
## Complete    -1.00  -0.76   -0.99    -0.75
## Single      -0.76  -1.00   -0.80    -0.84
## Average     -0.99  -0.80   -1.00    -0.74
## Centroid    -0.75  -0.84   -0.74    -1.00</code></pre>
<pre class="r"><code>library(corrplot)
corrplot(cors, &quot;pie&quot;,&quot;lower&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="visualizing-dendrograms" class="section level1">
<h1>Visualizing Dendrograms</h1>
<pre class="r"><code>data(&quot;USArrests&quot;)
df_scale &lt;- USArrests%&gt;%mutate_all(.funs = funs(scale(.)))

rownames(df_scale) &lt;- rownames(USArrests)
dd &lt;- dist(df_scale, method = &quot;euclidean&quot;)

hc &lt;- dd%&gt;%hclust(method =  &quot;ward.D2&quot;)
hc</code></pre>
<pre><code>## 
## Call:
## hclust(d = ., method = &quot;ward.D2&quot;)
## 
## Cluster method   : ward.D2 
## Distance         : euclidean 
## Number of objects: 50</code></pre>
<pre class="r"><code>library(factoextra)
fviz_dend(hc, cex = 0.5)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<pre class="r"><code>fviz_dend(hc, cex = 0.5,
          main = &quot;Dendogram - ward.D2&quot;,
          xlab = &quot;Objects&quot;,
          ylab = &quot;Distance&quot;,
          sub = &quot;&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<pre class="r"><code>fviz_dend(hc, k=4, 
          cex = 0.5,
          k_colors = c(&quot;#EE3B3B&quot;, &quot;#8470FF&quot;, &quot;#76EEC6&quot;, &quot;#EEC900&quot;),
          main = &quot;Dendogram - ward.D2&quot;,
          xlab = &quot;Objects&quot;,
          ylab = &quot;Distance&quot;,
          sub = &quot;&quot;,
          color_labels_by_k = TRUE,
          rect = TRUE,
          rect_border = c(&quot;#EE3B3B&quot;, &quot;#8470FF&quot;, &quot;#76EEC6&quot;, &quot;#EEC900&quot;),
          rect_fill = TRUE)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<pre class="r"><code>fviz_dend(hc, k=4, 
          cex = 0.5,
          k_colors = c(&quot;#EE3B3B&quot;, &quot;#8470FF&quot;, &quot;#76EEC6&quot;, &quot;#EEC900&quot;),
          main = &quot;Dendogram - ward.D2&quot;,
          xlab = &quot;Objects&quot;,
          ylab = &quot;Distance&quot;,type = &quot;circular&quot;,
          sub = &quot;&quot;,
          color_labels_by_k = TRUE,
          rect = TRUE,
          rect_border = c(&quot;#EE3B3B&quot;, &quot;#8470FF&quot;, &quot;#76EEC6&quot;, &quot;#EEC900&quot;),
          rect_fill = TRUE)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<pre class="r"><code>require(igraph)</code></pre>
<pre><code>## Loading required package: igraph</code></pre>
<pre><code>## 
## Attaching package: &#39;igraph&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     as_data_frame, groups, union</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     compose, simplify</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     crossing</code></pre>
<pre><code>## The following object is masked from &#39;package:tibble&#39;:
## 
##     as_data_frame</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     decompose, spectrum</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     union</code></pre>
<pre class="r"><code>fviz_dend(hc, k=4, 
          k_colors = &quot;jco&quot;,
          main = &quot;Dendogram - ward.D2&quot;,
          xlab = &quot;Objects&quot;,
          ylab = &quot;Distance&quot;,
          sub = &quot;&quot;,
          type = &quot;phylogenic&quot;,
          phylo_layout = &quot;layout.gem&quot;,
          repel = TRUE)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
</div>
<div id="cluster-validation" class="section level1">
<h1>Cluster Validation</h1>
<ul>
<li>Assessing clustering tendency</li>
<li>Determing the optimal number of clusters</li>
<li>Cluster validation statistics</li>
<li>Choosing the best clustering algorithms</li>
<li>Computing p-value for hierarchial clustering</li>
</ul>
<div id="assessing-clustering-tendency" class="section level2">
<h2>Assessing Clustering Tendency</h2>
<div id="required-r-packages" class="section level3">
<h3>Required R packages</h3>
</div>
<div id="data-preparation" class="section level3">
<h3>Data preparation</h3>
<pre class="r"><code>head(iris, 3)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa</code></pre>
<pre class="r"><code>df &lt;- iris%&gt;%select(-Species)
random_df &lt;- apply(df,2, function(x){
  runif(length(x),min(x),max(x))
})
random_df &lt;- as.data.frame(random_df)
df &lt;- iris_scaled &lt;- df%&gt;%mutate_all(.funs = funs(scale(.)))%&gt;%as.vector
random_df &lt;- random_df %&gt;% mutate_all(.funs = funs(scale(.))) %&gt;% as.vector</code></pre>
</div>
<div id="visual-inspection-of-the-data" class="section level3">
<h3>Visual inspection of the data</h3>
<pre class="r"><code>library(factoextra)
fviz_pca_ind(prcomp(df), title= &quot;PCA - Iris data&quot;,
             habillage = iris$Species, palette = &quot;jco&quot;,
             geom = &quot;point&quot;,
             ggtheme = theme_classic(),
             legend = &quot;bottom&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<pre class="r"><code>fviz_pca_ind(prcomp(random_df), title= &quot;PCA - Random data&quot;,
             habillage = iris$Species, palette = &quot;jco&quot;,
             geom = &quot;point&quot;,
             ggtheme = theme_classic(),
             legend = &quot;bottom&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="why-assessing-clustering-tendency" class="section level3">
<h3>Why assessing clustering tendency?</h3>
<pre class="r"><code>library(factoextra)
set.seed(123)

km_res1 &lt;- kmeans(df, 3)
fviz_cluster(list(data = df, cluster = km_res1$cluster),
             ellipse.type = &quot;norm&quot;, geom = &quot;point&quot;, stand = FALSE,
             palette = &quot;jco&quot;, ggtheme = theme_classic())</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
</div>
<div id="k-means-on-the-random-dataset" class="section level3">
<h3>K-means on the random dataset</h3>
<pre class="r"><code>km_res2 &lt;- kmeans(random_df, 3)
fviz_cluster(list(data = df, cluster = km_res2$cluster),
             ellipse.type = &quot;norm&quot;, geom = &quot;point&quot;, stand = FALSE,
             palette = &quot;jco&quot;, ggtheme = theme_classic())</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
<div id="hierarchial-clustering-on-random-data-set" class="section level3">
<h3>Hierarchial clustering on random data set</h3>
<pre class="r"><code>fviz_dend(hclust(dist(random_df)), k = 3, k_colors = &quot;jco&quot;, as.ggplot = TRUE, show_labels = FALSE)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
</div>
<div id="methods-for-assessing-clustering-tendency" class="section level3">
<h3>Methods for assessing clustering tendency</h3>
<p>There are two methods recommended for evaluating the clustering tendency:</p>
<ul>
<li>Statistical method - <em>Hopkins statistic</em></li>
<li>Visual methods - <em>Visual Assessment of cluster Tendency (VAT) algorithm</em></li>
</ul>
<div id="statistical-methods" class="section level4">
<h4>Statistical Methods</h4>
<p>Hopkins statistical method.</p>
<ul>
<li><strong>Null hypothesis:</strong> the data set D is uniformly distributed (i.e., no meaningful clusters)</li>
<li><strong>Alternative hypothesis:</strong> the dataset D is not uniformly distributed (i.e., contains meaningful clusters)</li>
</ul>
<p>Rejecting the Null hypothesis occurs if the Hopkins statistic is close to zero.</p>
<p><strong>Non-Random Data Set</strong></p>
<pre class="r"><code>library(clustertend)
set.seed(123)
hopkins(df,n = nrow(df)-1)</code></pre>
<pre><code>## $H
## [1] 0.1815219</code></pre>
<p>Null Hypothesis is rejected. Clustering is possible.</p>
<p><strong>Random Data Set</strong></p>
<pre class="r"><code>set.seed(123)
hopkins(random_df,n = nrow(random_df) - 1)</code></pre>
<pre><code>## $H
## [1] 0.5145653</code></pre>
<p>Null Hypothesis is TRUE. Clustering is not possible</p>
</div>
<div id="visual-methods" class="section level4">
<h4>Visual methods</h4>
<pre class="r"><code>fviz_dist(dist(df), show_labels = FALSE) + 
  labs(title = &quot;Iris data&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<pre class="r"><code>fviz_dist(dist(random_df), show_labels = FALSE) +
  labs(title = &quot;Random data&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="determining-the-optimal-number-of-clusters" class="section level2">
<h2>Determining the Optimal Number of Clusters</h2>
<p>There is no specific method for determing the optimal number of clusters. There are about 30 algorithms that can be used to project the best number of clusters. The following 3 methods are fequently consumed:</p>
<ul>
<li>Elbow method</li>
<li>Average silhoette method</li>
<li>Gap statistic method</li>
</ul>
<div id="computing-the-number-of-clusters-using-r" class="section level3">
<h3>Computing the number of clusters using R</h3>
<p>Two functions to use:<br />
1) factoextra::fviz_nbclust()
2) NbClust::NbClust()</p>
<pre class="r"><code>library(factoextra)
library(NbClust)</code></pre>
</div>
<div id="data-preparation-1" class="section level3">
<h3>Data preparation</h3>
<pre class="r"><code>df &lt;- USArrests %&gt;% mutate_all(.funs = funs(scale(.))) %&gt;% as.vector
head(df)</code></pre>
<pre><code>##       Murder   Assault   UrbanPop         Rape
## 1 1.24256408 0.7828393 -0.5209066 -0.003416473
## 2 0.50786248 1.1068225 -1.2117642  2.484202941
## 3 0.07163341 1.4788032  0.9989801  1.042878388
## 4 0.23234938 0.2308680 -1.0735927 -0.184916602
## 5 0.27826823 1.2628144  1.7589234  2.067820292
## 6 0.02571456 0.3988593  0.8608085  1.864967207</code></pre>
<p><strong>Elbow Method (WSS)</strong></p>
<pre class="r"><code>fviz_nbclust(df,kmeans, method = &quot;wss&quot;) +
  geom_vline(xintercept = 4, linetype = 2)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
<p><strong>Silhouette Method</strong></p>
<pre class="r"><code>fviz_nbclust(df, kmeans, method = &quot;silhouette&quot;) + 
  labs(subtitle = &quot;Silhouette method&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p><strong>Gap Statitic Method</strong></p>
<pre class="r"><code>set.seed(123)
fviz_nbclust(df,kmeans, nstart = 25, method = &quot;gap_stat&quot;, nboot =50) +
  labs(subtitle = &quot;Gap statitic method&quot;)</code></pre>
<p><img src="/blog/2019-05-14-cluster-analysis_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
</div>
</div>
</div>
